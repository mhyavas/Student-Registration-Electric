{"version":3,"sources":["hyperfiddle/electric.cljc"],"mappings":";AAuBG,AAAA,CAAA,AAAA,2DAAAA,3DAAaC;;AAAb,CAAA,AAAA,AAAaA,yEAEX,WAASC,MAAKC;AAAd,AAAA,gBAAA,ZAASD;AAAT,AACE,yBAAWD,jBAAQE;;AAGvB,AAAA,CAAA,AAAA,2DAAAH,3DAAaI;;AAAb,CAAA,AAAA,AAAaA,yEAEX,WAASF,MAAKC;AAAd,AAAA,gBAAA,ZAASD;AAAT,AACE,SAAK,kBAAWE,jBAAQD,oDACnB,AAACE,6CAAE,AAASH,gBAAM,AAASC;;AAE9B,CAAM,AAAA,AAAIG,uDAAmC,AAAAC;AAEnD,AAAA,CAAA,AAAA,+DAAAP,/DAAaM;;AAAb,CAAA,AAAA,AAAaA,6EAEX,WAASJ,MAAKC;AAAd,AAAA,gBAAA,ZAASD;AAAT,AACE,SAAK,kBAAWI,jBAAYH,wDACvB,AAACE,6CAAE,AAASH,gBAAM,AAASC;;AAYvC;;;;;;;AAAKK,4BAKHC;AAEF,AAAKC,4BAAKC;AACV,AAAKC,4BAAKC;AACV,AAAKC,6BAAKC;AAEV,4BAAA,5BAASC,gEAAMC,EAAEC;AAAjB,AACE,OAAAC,gDAAA,mCAAA,sDAAAC;AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,IAAAC,kBACcmC;IADdlC,kBACa,iBAAAiC,eAAAlC;AAAA,AAAA,QAAAkC,6CAAAA,+CAAAA;;IADbhC,kBAEciC;IAFdhC,kBAEa,iBAAAiC,eAAAlC;AAAA,AAAA,QAAAkC,6CAAAA,+CAAAA;;IAFbhC,kBAIOqC;IAJPpC,kBAAA,oBAAA,mCAAA,2CAAA,oDAAAC;IAAAC,kBAKW,WAAQsC;AAAR,AAAA,AAAW,OAAA/C,gDAAA,mCAAA,WAAAgD;AAAA,AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,AAAA,AAAA,IAAAC,kBAAA9C;AAAA,AAAA,AAAA,AAAA,CAAA6C,cAAA,OAAAE;;AAAA,OAAAzB,qBAAAwB;gBAAA,IAAAE,SAAAC;AAAA,AAAA,IAAAC,oBAAAF;AAAA,AAAA,AAAA,AAAA,CAAAH,cAAA,OAAA;;AAAA,MAAAK;;sBAAA,WAAAL;AAAA,AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,AAAA,AAAA,IAAAM,kBAAA,AAAAzB;IAAA0B,kBAAAD;sBAAHP,lBAAGS;IAAAC,kBAAM,iBAAAK,WAAAN;IAAAO,eAAAR;AAAA,AAAA,AAAA,IAAAS,WAAAF;IAAAG,eAAAF;AAAA,AAAA,QAAAE,6CAAAA,2CAAAD,YAAAC,uBAAAD;;AAAN,AAAA,AAAA,AAAA,CAAAhB,cAAA,OAAA;;AAAAS;gBAAA,IAAAC,SAAAC;AAAA,AAAA,IAAAN,oBAAAK;AAAA,AAAA,AAAA,AAAA,CAAAV,cAAA,OAAA;;AAAA,MAAAK;;AAAA,AAAA,AAAA,OAAAtB,0BAAA,iBAAA6B,WAAA,AAAA3B,qDAAA;AAAA,AAAA,AAAA,CAAA2B,SAAA,OAAAC;;AAAAD;;KAAAzB;;IALtBzB,kBAMU,WAAQwD;AAAR,AAAA,qBAAQA,rBAAG,IAAAC;IAAAC,qBAAA/D;AAAA,AAAA,CAAA+D,mDAAAA,iDAAAD,kBAAAC,6BAAAD;;AAAX;AAAA,AAAA,AAAA;;;IANVxD,kBAKSZ;IALTa,kBAAAH;IAAAI,mBAAAH;IAAAI,mBAKQ,iBAAA8B,WAAAhC;IAAAiC,WAAAhC;IAAAiC,eAAAnC;AAAA,AAAA,QAAAmC,6CAAAA,2CAAAF,SAAAC,YAAAC,uBAAAF,SAAAC;;IALR9B,mBAOW,WAAQgC;AAAR,AAAA,AAAW,OAAA/C,gDAAA,mCAAA,WAAA0E;AAAA,AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,AAAA,AAAA,IAAAC,kBAAAtE;AAAA,AAAA,AAAA,AAAA,CAAAqE,cAAA,OAAAE;;AAAA,OAAAnD,qBAAAkD;gBAAA,IAAAE,SAAAC;AAAA,AAAA,IAAAC,oBAAAF;AAAA,AAAA,AAAA,AAAA,CAAAH,cAAA,OAAA;;AAAA,MAAAK;;sBAAA,WAAAL;AAAA,AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,AAAA,AAAA,IAAAM,kBAAA,AAAAnD;IAAAoD,kBAAAD;sBAAHjC,lBAAGmC;IAAAC,kBAAM,iBAAAK,WAAAN;IAAAO,eAAAR;AAAA,AAAA,AAAA,IAAAS,WAAAF;IAAAG,eAAAF;AAAA,AAAA,QAAAE,6CAAAA,2CAAAD,YAAAC,uBAAAD;;AAAN,AAAA,AAAA,AAAA,CAAAhB,cAAA,OAAA;;AAAAS;gBAAA,IAAAC,SAAAC;AAAA,AAAA,IAAAN,oBAAAK;AAAA,AAAA,AAAA,AAAA,CAAAV,cAAA,OAAA;;AAAA,MAAAK;;AAAA,AAAA,AAAA,OAAAhD,0BAAA,iBAAAuD,WAAA,AAAArD,qDAAA;AAAA,AAAA,AAAA,CAAAqD,SAAA,OAAAC;;AAAAD;;KAAAnD;;IAPtBnB,mBAQU,WAAQkD;AAAR,AAAA,qBAAQA,rBAAG,IAAA0B;IAAAC,qBAAA1F;AAAA,AAAA,CAAA0F,mDAAAA,iDAAAD,kBAAAC,6BAAAD;;AAAX;AAAA,AAAA,AAAA;;;IARV3E,mBAOQ,WAAAoD;AAAA,AAAA,AAEG,MAAAA;;IATXnD,mBAOSpB;IAPTqB,mBAAAJ;IAAAK,mBAAAJ;IAAAK,mBAAAJ;IAAAK,mBAOQ,iBAAAgD,WAAAnD;IAAAoD,WAAAnD;IAAAoD,WAAAnD;IAAAoD,eAAAvD;AAAA,AAAA,QAAAuD,6CAAAA,2CAAAH,SAAAC,SAAAC,YAAAC,uBAAAH,SAAAC,SAAAC;;IAPRjD,mBAIM,iBAAAgB,WAAAhC;IAAAiC,WAAA1B;IAAA2B,WAAAnB;IAAAoB,eAAApC;AAAA,AAAA,QAAAoC,6CAAAA,2CAAAH,SAAAC,SAAAC,YAAAC,uBAAAH,SAAAC,SAAAC;;AAJN,AAAA,AAAA,CAAAxC,cAAA,OAAAuB;;AAAA,OAAAC,qBAAAF;gBAAA,IAAAG,oBAAAC;AAAA,AAAA,AAAA,CAAA1B,cAAA,OAAA;;AAAA,MAAAyB;;sBAAA,sDAAAzB;AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,IAAA2B,mBAAA,AAAAC;AAAA,AAAA,AAAA,CAAA5B,cAAA,OAAA;;AAAA2B;gBAAA,IAAAF,oBAAAI;AAAA,AAAA,AAAA,CAAA7B,cAAA,OAAA;;AAAA,MAAAyB;;AAAA,AAAA,OAAAK,0BAAA,iBAAAC,WAAA,AAAAC,qDAAA;AAAA,AAAA,CAAAD,SAAA,OAAAE;;AAAAF;;KAAAG;;AAqBF,sCAAA,tCAAS2D,oFAAU/C;AAAnB,AAAsB,qBAAW9D,bAAQ8D;;AAwBzC,AAAA,mCAAA,2CAAAgD,9EAASE;AAAT,AAAA,IAAAD,WAAA,AAAA;AAAA,AAAA,QAAAA;KAAA;AAAA,OAAAC,+DAAA,CAAA,UAAA;;;KAAA;AAAA,OAAAA,+DAAA,CAAA,UAAA,MAAA,CAAA,UAAA;;;;AAAA,MAAA,KAAAC,MAAA,CAAA,8DAAA,AAAA;;;;;AAAA,CAAA,iEAAA,jEAASD,4EACLE;AADJ,AACQ,OAACC,+DAASD,QAAG,KAAAlH,6BAAU,KAAAH;;;AAD/B,CAAA,iEAAA,jEAASmH,4EAELE,QAAGE;AAFP,2GAEqB,AAAArG,gDAAA,mCAAA,+CAAAsG,7OAAgB,gEAAA,zDAACU,4FAAgBX;AAAjC,AAAA,IAAA,AAAA,AAAA,AAAA,IAAAE,kBAAWJ;AAAX,AAAA,AAAA,CAAAG,cAAA,OAAAE;;AAAA,OAAA/E,qBAAA8E;gBAAA,IAAAE,oBAAAC;AAAA,AAAA,AAAA,CAAAJ,cAAA,OAAA;;AAAA,MAAAG;;sBAAA,+CAAAH;AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,IAAAK,kBAAA,AAAA9E;AAAA,AAAA,AAAA,CAAAyE,cAAA,OAAA;;AAAAK;gBAAA,IAAAF,oBAAAG;AAAA,AAAA,AAAA,CAAAN,cAAA,OAAA;;AAAA,MAAAG;;AAAA,AAAA,OAAA1E,0BAAA,iBAAA8E,WAAA,AAAA5E,qDAAA;AAAA,AAAA,CAAA4E,SAAA,OAAAC;;AAAAD;;KAAAE;;;AAFrB,CAAA,2DAAA,3DAASd;;AAAT,AAUG,AAAA;;;;;;;;;;;;;AAAA,AAAA,CAAA,AAAA,4CAAA,WAAAgB,vDAASS;;AAAT,AAAA,IAAAR,SAAA;AAAA,AAAA,IAAAC,WAAA,CAAA,AAAA,mBAAA;AAAA,AAAA,QAAAA;KAAA;AAAA,OAAAD;;;;AAAA,MAAA,KAAAhB,MAAA,CAAA,8DAAA,CAAA,AAAA,mBAAA;;;;;AAAA,CAAA,AAAA,6CAAA,WAAAgB,OAAAE,/DAASM;;AAAT,AAAA,IAAAR,aAAA;AAAA,AAAA,OAAA,AAAAA,sBAAAA,WAAA,AAAA,CAAAA,mBAAA,AAAAG,iBAAAD;;;AAAA,CAAA,AAAA,qEAAA,rEAASM;;AAAT,AAAA,QAAA,JAIYK;AAJZ,AAKI,GAAI,gBAAA,fAAOH;AACT,0BAAA,lBAAMC;;AACN,AAAI,AAAuBG,4BAAUJ;;AACjC,QAACE,kDAAAA,oDAAAA;;;;AARX,CAAA,AAAA,uEAAA,vEAASJ,kFAUEK;;AAVX,AAAA,YAAA,RAUWA;AAVX,AAYI,GAAI,oBAAA,nBAAMF;AACR,CAACC,kDAAAA,oDAAAA;;AACD,CAAMF,aAAI,AAAwBI,6BAAUH;;;AAdlD;;;AAAA,CAAA,sCAAA,tCAASH;AAAT,AAAA,AAAA;;;AAAA,CAAA,4CAAA,5CAASA;;AAAT,CAAA,+CAAA,/CAASA;;AAAT,CAAA,oDAAA,WAAAJ,mBAAAC,qBAAAC,vGAASE;AAAT,AAAA,OAAAD,iBAAAF,qBAAA;;;AAAA;;;kCAAA,lCAASI,4EAAyBC,IACRC,SACVC;AAFhB,AAAA,YAAAJ,2BAAkCE,IACRC,SACVC;;;AAFPJ,AAkBZ;;;AAAcO,iCACH,yCAAQC,EAAEC;AAAV,AACE,IAAMC,SAAO,gCAAA,IAAA,pCAACT,yCAAcQ;AAA5B,AACE,CAAM,AAAYC,kBAChB,WAAQL;AAAR,AAAW,cAAA,bAAM,AAAOK;;AAAW,QAACF,kCAAAA,oCAAAA;;;AACtC,CAACA,kCAAAA,oCAAAA;;AAAGE;;AAoBnB,AAAA,2CAAA,mDAAArC,9FAAS2C;AAAT,AAAA,IAAAL,qBAAA;AAAA,AAAA,IAAAC,0BAAA,AAAA;AAAA,AAAA,IAAAC,wBAAA;;AAAA,AAAA,GAAA,CAAAA,wBAAAD;AAAA,AAAA,AAAAD,wBAAA,CAAA,UAAAE;;AAAA,eAAA,CAAAA,wBAAA;;;;AAAA;;;;AAAA,IAAAC,uBAAA,EAAA,CAAA,MAAA,AAAAH,4BAAA,AAAA,KAAAI,qBAAA,AAAAJ,yBAAA,KAAA,IAAA,OAAA;AAAA,AAAA,OAAAK,8EAAAF;;;AAAA,AAAA,CAAA,gFAAA,WAAAG,3FAASD;AAAT,AAAA,IAAAE,aAAAD;QAAA,AAAAE,4CAAAD,WAAA,IAAA,/DAAiCb;AAAjC,AAA8E,OAACkB;;;AAA/E,CAAA,mEAAA,nEAASP;;AAAT;AAAA,CAAA,6DAAA,WAAAI,xEAASJ;AAAT,AAAA,IAAAK,qBAAA;AAAA,AAAA,OAAAA,wDAAA,AAAAC,cAAAF;;;AAAA,AAIS,oCAAA,pCAASI,gFAAcC,KAAKC,IAAIC,EAAEC;AAAlC,AACE,AAAmBH,sBAAKC,IAAIC,EAAE,AAACE,qBAAQD;;AADzC;AAAA,AAEG,OAAsBH,yBAAKC,IAAIC;;;AAElC,AAAA,kCAAA,0CAAAtD,5EAAS0D;AAAT,AAAA,IAAAD,WAAA,AAAA;AAAA,AAAA,QAAAA;KAAA;AAAA,OAAAC,8DAAA,CAAA,UAAA,MAAA,CAAA,UAAA;;;KAAA;AAAA,OAAAA,8DAAA,CAAA,UAAA,MAAA,CAAA,UAAA,MAAA,CAAA,UAAA;;;KAAA;AAAA,OAAAA,8DAAA,CAAA,UAAA,MAAA,CAAA,UAAA,MAAA,CAAA,UAAA,MAAA,CAAA,UAAA;;;;AAAA,MAAA,KAAAvD,MAAA,CAAA,8DAAA,AAAA;;;;;AAAA,CAAA,gEAAA,hEAASuD,2EACLN,KAAKO;AADT,AACqB,wGAAA,jGAACC,8DAAQR,KAAKO,WAAWE;;;AAD9C,CAAA,gEAAA,hEAASH,2EAELN,KAAKO,WAAWG;AAFpB,AAE8B,mGAAA,5FAACF,8DAAQR,KAAKO,WAAWG;;;AAFvD,CAAA,gEAAA,hEAASJ,2EAGLN,KAAKO,WAAWG,cAASP;AAH7B,AAIG,+BAAA,xBAACQ,2DACC,AAACC,wBAAU,WAAQ7F;AAAR,AACE,yDAAA,WAAA8F,7DAACd,kCAAaC,KAAKO;AAAnB,AAA+B,IAAAO,qBAAc,2FAAAD,4CAAAA,tIAACH,8CAAAA,gEAAAA;AAAf,AAAA,GAAA,CAAAI,sBAAA;AAAA;;AAAA,QAAAA,JAAYC;AAAZ,AACE,QAAChG,uCAAAA,0CAAAA,LAAEgG,sBAAAA;;GAAIZ;;;;AAP1D,CAAA,0DAAA,1DAASG;;AAAT,AASA,AAAKU,gDACH,AAGI,AAACE,4DAAS,WAAQtC;AAAR,AAAW,OAAmBqC;0KAFrC,uEAAA,vEAACT,8DAAQS,nLACZ,yDAAA,zDAACpD,4FAAgB,AAAmBoD;AAGnD,AAEA,AAGA,AAKA,AAEA,6CAAA,7CAASE,kGAAkBC,KAAKC,SAASC;AAAzC,AACE,GAAM,AAACC,gDAAKF,SAASC;AAArB,AACE,MAAO,AAACE,gDAAQ,CAAA,0DAAmB,iBAAAC,mBAAIL;AAAJ,AAAA,oBAAAK;AAAAA;;AAAS,+GAAA,xGAACC;;iKAAtC,2CAAA,tMAAS,6DAAA,sEAAA,hFAA2DL,wEAA2BC,gIACtFF;;AAFlB;;;AAmDF,wCAAA,xCAAkBO,wFAAY/H;AAA9B,AAEW,GAAA,GAAA,MAAA,LAAuBA;AAAvB,GAAA,EAAA,CAAA,wCAAA,UAAA,CAAAlE,gCAAA,nFAAuBkE,mFAAAA;AAAvB;;AAAA,GAAA,EAAA,AAAuBA;AAAvB,OAAAgI,kCAAYC,qBAAWjI;;AAAvB;;;;AAAA,OAAAgI,kCAAYC,qBAAWjI;;;AAElC,qCAAA,rCAAkBkI,kFAAe9E;AAAjC,AACE,GAAQ,AAAC2E,sCAAW3E;AAApB;AAAA,AAAA,MAAA,KAAAD,MAAA,CAAA,kBAAA,sCAAA,KAAA;;;AACA,OAACgF,sBAAQ/E;;AAEX,oDAAA,pDAAKgF;AAQL,AAAA,yCAAA,iDAAApF,1FAASsF;AAAT,AAAA,IAAAD,WAAA,AAAA;AAAA,AAAA,QAAAA;KAAA;AAAA,OAAAC,qEAAA,CAAA,UAAA,MAAA,CAAA,UAAA;;;KAAA;AAAA,OAAAA,qEAAA,CAAA,UAAA,MAAA,CAAA,UAAA,MAAA,CAAA,UAAA;;;;AAAA,MAAA,KAAAnF,MAAA,CAAA,8DAAA,AAAA;;;;;AAAA,CAAA,uEAAA,vEAASmF,kFACLC,MAAMC;AADV,AACgB,kFAAA,3EAACC,qEAAkBF,WAAUC;;;AAD7C,CAAA,uEAAA,vEAASF,kFAELC,MAAMG,KAAKF;AAFf,AAEqB,gEAAA,zDAACvE,4FAAgByE,KAAK,AAAAzL,gDAAA,mCAAA,+CAAA0L;AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,IAAAC,kBAAA,AAAA9J;IAAA+J,kBAAA;IAAAC,kBAAA;AAAA,AAAA,AAAA,CAAAH,cAAA,OAAAI;;AAAA,CAAAJ,cAAA,OAAAC;;AAAA,CAAAD,cAAA,OAAAE;;AAAA,CAAAF,cAAA,OAAAG;;AAAAH;gBAAA,IAAAK,oBAAAC;AAAA,AAAA,AAAA,CAAAN,cAAA,OAAA;;AAAA,MAAAK;;sBAAA,+CAAAL;AAAA,AAAA,IAAA,AAAA,IAAAE,kBAAA,CAAAF,cAAA;AAAA,AAAA,IAAAO,mBAAAL;IAAAM,mBACQ,kBAAAD;AADR,AAAA,AAAA,CAAAP,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA;gBAAA,IAAAK,oBAAAI;AAAA,AAAA,AAAA,CAAAT,cAAA,OAAAU;;AAAA,CAAAV,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAAK;;AAAAL;;sBAAA,+CAAAA;AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,IAAAW,mBAAA;AAAA,AAAA,AAAA,CAAAX,cAAA,OAAAY;;AAAA,CAAAZ,cAAA,OAAAW;;AAAAX;gBAAA,IAAAK,oBAAAQ;AAAA,AAAA,AAAA,CAAAb,cAAA,OAAAU;;AAAA,CAAAV,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAAK;;AAAAL;;uBAAA,gDAAAA;AAAA,AAAA,IAAA,AAAA,IAAAc,mBAAA,CAAAd,cAAA;AAAA,AAAA,AAAA,CAAAA,cAAA,OAAAU;;AAAA,CAAAV,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAAc;;AAAAd;gBAAA,IAAAK,oBAAAU;AAAA,AAAA,AAAA,CAAAf,cAAA,OAAAU;;AAAA,CAAAV,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAAK;;AAAAL;;sBAAA,+CAAAA;AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,IAAAgB,mBAAA;IAAAC,mBAAA;AAAA,AAAA,oBAAAD;AAAA,AAAA,CAAAhB,cAAA,OAAAkB;;AAAA,CAAAlB,cAAA,OAAA;;AAAAA;;AAAA,AAAA,CAAAA,cAAA,OAAAmB;;AAAA,CAAAnB,cAAA,OAAAiB;;AAAAjB;;gBAAA,IAAAK,oBAAAe;AAAA,AAAA,AAAA,CAAApB,cAAA,OAAAU;;AAAA,CAAAV,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAAK;;AAAAL;;sBAAA,+CAAAA;AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,IAAAqB,kBAAA,AAAAlL;AAAA,AAAA,AAAA,CAAA6J,cAAA,OAAAU;;AAAA,CAAAV,cAAA,OAAAqB;;AAAArB;gBAAA,IAAAK,oBAAAiB;AAAA,AAAA,AAAA,CAAAtB,cAAA,OAAAuB;;AAAA,CAAAvB,cAAA,OAAAK;;AAAAL;;uBAAA,gDAAAA;AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,IAAAwB,mBAAA,AAAArL;AAAA,AAAA,AAAA,CAAA6J,cAAA,OAAAyB;;AAAA,CAAAzB,cAAA,OAAAwB;;AAAAxB;gBAAA,IAAAK,oBAAAqB;AAAA,AAAA,AAAA,CAAA1B,cAAA,OAAAU;;AAAA,CAAAV,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAAK;;AAAAL;;sBAAA,+CAAAA;AAAA,AAAA,IAAA,AAAA,IAAAE,kBAAA,CAAAF,cAAA;AAAA,AAAA,IAAA2B,mBAAAzB;IAAA0B,mBAAA;IAAAC,mBAAAC;AAAA,AAAA,AAAA,CAAA9B,cAAA,OAAA+B;;AAAA,OAAAC,qBAAAJ,iBAAAC;gBAAA,IAAAxB,oBAAA4B;AAAA,AAAA,AAAA,CAAAjC,cAAA,OAAAU;;AAAA,CAAAV,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAAK;;AAAAL;;sBAAA,+CAAAA;AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,IAAAkC,kBAAoBrC;AAApB,AAAA,AAAA,CAAAG,cAAA,OAAAmC;;AAAA,OAAAC,wBAAAF;gBAAA,IAAA7B,oBAAAgC;AAAA,AAAA,AAAA,CAAArC,cAAA,OAAA;;AAAA,MAAAK;;sBAAA,+CAAAL;AAAA,AAAA,IAAA,AAAA,IAAAiB,mBAAA,CAAAjB,cAAA;AAAA,AAAA,AAAA,CAAAA,cAAA,OAAAyB;;AAAA,CAAAzB,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAAiB;;AAAAjB;gBAAA,IAAAK,oBAAAiC;AAAA,AAAA,AAAA,CAAAtC,cAAA,OAAAU;;AAAA,CAAAV,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAAK;;AAAAL;;sBAAA,+CAAAA;AAAA,AAAA,IAAA,AAAA,IAAAE,kBAAA,CAAAF,cAAA;AAAA,AAAA,IAAAuC,kBAAArC;IAAAsC,mBAEoBmB;IAFpBlB,mBACQ,CAAAF,2BAAAC;IADR1B,mBAAA;AAAA,AAAA,GAAA2B;AAAA,AAAA,CAAAzC,cAAA,OAAA0C;;AAAA,CAAA1C,cAAA,OAAAc;;AAAAd;;AAAA,AAAA,CAAAA,cAAA,OAAA2C;;AAAA,CAAA3C,cAAA,OAAAc;;AAAAd;;gBAAA,IAAAK,oBAAAuC;AAAA,AAAA,AAAA,CAAA5C,cAAA,OAAAU;;AAAA,CAAAV,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAAK;;AAAAL;;uBAAA,gDAAAA;AAAA,AAAA,IAAA,AAAA,IAAAG,kBAAA,CAAAH,cAAA;IAAAE,kBAAA,CAAAF,cAAA;AAAA,AAAA,IAAA6C,mBAAA,kBAAA1C,iBAAA,kBAAAD,oBAAAA;AAAA,AAAA,AAAA,CAAAF,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA6C;gBAAA,IAAAxC,oBAAAyC;AAAA,AAAA,AAAA,CAAA9C,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,MAAAK;;sBAAA,+CAAAL;AAAA,AAAA,IAAA,AAAA,IAAAC,kBAAA,CAAAD,cAAA;AAAA,AAAA,IAAA+C,kBACmBW;IADnBV,kBAC2BpD;IAD3BqD,kBAAAhD;IAAAiD,kBACkB,iBAAAK,WAAAP;IAAAQ,WAAAP;IAAAQ,eAAAV;AAAA,AAAA,QAAAU,6CAAAA,2CAAAF,SAAAC,YAAAC,uBAAAF,SAAAC;;AADlB,AAAA,AAAA,CAAAxD,cAAA,OAAAmD;;AAAA,CAAAnD,cAAA,OAAA;;AAAA,OAAAjK,qBAAAmN;gBAAA,IAAA7C,oBAAA+C;AAAA,AAAA,AAAA,CAAApD,cAAA,OAAAuB;;AAAA,CAAAvB,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAAK;;AAAAL;;AAAA,AAAA,OAAA3J,0BAAA,iBAAAgN,WAAA,AAAA9M,qDAAA;AAAA,AAAA,CAAA8M,SAAA,OAAAC;;AAAAD;;KAAAhI;;;AAF3C,CAAA,iEAAA,jEAASsE;;AAAT,AAaA,gCAAA,hCAASiE,wEAAUC,IAAIC;AAAvB,AACE,OAAAxP,gDAAA,mCAAA,0DAAAyP;AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,IAAAC,kBAAA,AAAA7N;IAAA8N,kBAAA;IAAAC,kBAAAC;IAAAC,kBAAAC;IAAAC,kBAAA;IAAAC,mBAEI,iBAAA+C,WAAAhD;IAAAiD,eAAAnD;AAAA,AAAA,QAAAmD,6CAAAA,2CAAAD,YAAAC,uBAAAD;;IAFJ9C,mBAEI,iBAAAgD,WAAAjD;IAAAkD,eAAAvD;AAAA,AAAA,QAAAuD,6CAAAA,2CAAAD,YAAAC,uBAAAD;;AAFJ,AAAA,AAAA,CAAAzD,cAAA,OAAAU;;AAAA,CAAAV,cAAA,OAAAC;;AAAA,OAAAhC,qBAAAiC,gBAAAO;gBAAA,IAAAE,oBAAAC;AAAA,AAAA,AAAA,CAAAZ,cAAA,OAAA;;AAAA,MAAAW;;sBAAA,0DAAAX;AAAA,AAAA,IAAA,AAAA,IAAAa,mBAAA,CAAAb,cAAA;AAAA,AAAA,AAAA,CAAAA,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAAa;gBAAA,IAAAF,oBAAAG;AAAA,AAAA,AAAA,CAAAd,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,MAAAW;;sBAAA,0DAAAX;AAAA,AAAA,IAAA,AAAA,IAAAC,kBAAA,CAAAD,cAAA;AAAA,AAAA,IAAAe,mBAAAd;AAAA,AAAA,AAAA,CAAAD,cAAA,OAAAgB;;AAAA,CAAAhB,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAAe;;AAAAf;gBAAA,IAAAW,oBAAAM;AAAA,AAAA,AAAA,CAAAjB,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,MAAAW;;sBAAA,0DAAAX;AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,IAAAkB,mBAAA,AAAA9O;IAAA+O,mBAAAD;IAAAL,mBAAA;AAAA,AAAA,IAAAO,WAAAD;AAAA,AAAA,QAAAC;KAAA;AAAA,AAAA,CAAApB,cAAA,OAAAqB;;AAAA,CAAArB,cAAA,OAAAa;;AAAAb;;;KAAA;AAAA,AAAA,CAAAA,cAAA,OAAAsB;;AAAA,CAAAtB,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAAa;;AAAAb;;;;AAAA,AAAA,CAAAA,cAAA,OAAAuB;;AAAA,CAAAvB,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAAkB;;AAAAlB;;;gBAAA,IAAAW,oBAAAa;AAAA,AAAA,AAAA,CAAAxB,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,MAAAW;;sBAAA,0DAAAX;AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,IAAAyB,mBAAA,AAAArP;AAAA,AAAA,AAAA,CAAA4N,cAAA,OAAAgB;;AAAA,CAAAhB,cAAA,OAAAyB;;AAAAzB;gBAAA,IAAAW,oBAAAe;AAAA,AAAA,AAAA,CAAA1B,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,MAAAW;;sBAAA,0DAAAX;AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,IAAA2B,mBAAA,AAAAvP;IAAAwP,mBAAA;IAAAC,mBAAA9D;AAAA,AAAA,AAAA,CAAAiC,cAAA,OAAA8B;;AAAA,OAAA7D,qBAAA2D,iBAAAC;gBAAA,IAAAlB,oBAAAoB;AAAA,AAAA,AAAA,CAAA/B,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,MAAAW;;sBAAA,0DAAAX;AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,IAAAgC,kBAAA;IAAAC,kBACiB5H;IADjB6H,kBAAA,oBAAA,mCAAA,2CAAA,oDAAAnR;IAAAoR,kBAC8BpC;IAD9BqC,kBACgB,iBAAAgB,WAAAlB;IAAAmB,WAAAlB;IAAAmB,eAAArB;AAAA,AAAA,QAAAqB,6CAAAA,2CAAAF,SAAAC,YAAAC,uBAAAF,SAAAC;;AADhB,AAAA,AAAA,CAAArD,cAAA,OAAAqC;;AAAA,OAAApE,qBAAA+D,gBAAAI;gBAAA,IAAAzB,oBAAA2B;AAAA,AAAA,AAAA,CAAAtC,cAAA,OAAA;;AAAA,MAAAW;;sBAAA,0DAAAX;AAAA,AAAA,IAAA,AAAA,IAAAkB,mBAAA,CAAAlB,cAAA;AAAA,AAAA,IAAAuC,mBAAA;IAAAC,mBAAAtB;IAAAuB,mBAEI,CAAAF,6DAAAC;IAFJE,mBAEI,KAAAjM,MAAAgM;IAFJE,mBAEI,kBAAAD;AAFJ,AAAA,AAAA,CAAA1C,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA;gBAAA,IAAAW,oBAAAiC;AAAA,AAAA,AAAA,CAAA5C,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,MAAAW;;sBAAA,0DAAAX;AAAA,AAAA,IAAA,AAAA,AAAA,AAAA,IAAA6C,mBAEuBlD;IAFvBmD,mBAE+BhD;IAF/BiD,mBAEsB,iBAAAY,WAAAb;IAAAc,eAAAf;AAAA,AAAA,QAAAe,6CAAAA,2CAAAD,YAAAC,uBAAAD;;AAFtB,AAAA,AAAA,CAAA3D,cAAA,OAAAgD;;AAAA,OAAAhR,qBAAA+Q;gBAAA,IAAApC,oBAAAsC;AAAA,AAAA,AAAA,CAAAjD,cAAA,OAAA;;AAAA,CAAAA,cAAA,OAAA;;AAAA,MAAAW;;AAAA,AAAA,OAAArO,0BAAA,iBAAA4Q,WAAA,AAAA1Q,qDAAA;AAAA,AAAA,CAAA0Q,SAAA,OAAAC;;AAAAD;;KAAA5L;;AAuBF,AAsCA,AA4EA;;;gDAAA,hDAAeuM;AAOf,iCAAA,jCAASC,0EAAWhI;AAApB,uMAA+BA,vMAAK,OAACiI,uDAAW,AAACC,uBAAuB,qBAAA,rBAACC,oEAAaC;;AAOtF,mCAAA,nCAASC;AAAT,AAA6C,YAAAC;;AAkB7C,AAAKC,+BAAQ,KAAAhV","names":["cljs.core/PROTOCOL_SENTINEL","js/hyperfiddle.electric.Pending","this","other","js/hyperfiddle.electric.Failure","cljs.core._EQ_","js/hyperfiddle.electric.FailureInfo","cljs.core/ExceptionInfo","hyperfiddle.electric/eval","hyperfiddle.electric.impl.runtime/eval","hyperfiddle.electric/hook","hyperfiddle.electric.impl.runtime/hook","hyperfiddle.electric/bind","hyperfiddle.electric.impl.runtime/bind","hyperfiddle.electric/with","hyperfiddle.electric.impl.runtime/with","hyperfiddle.electric/pair","c","s","cljs.core.partial","cr37262-state","cr37262-place-0","cr37262-place-1","cr37262-place-2","cr37262-place-3","cr37262-place-4","cr37262-place-5","cljs.core/IMap","cr37262-place-6","cr37262-place-7","cr37262-place-8","cr37262-place-9","cr37262-place-10","cr37262-place-11","cr37262-place-12","cr37262-place-13","cr37262-place-14","cr37262-place-15","cr37262-place-16","cr37262-place-17","cr37262-place-18","cr37262-place-19","cr37262-place-20","cr37262-block-1","missionary.core/park","cr37262-exception","e37325","cr37262-place-21","missionary.core/unpark","e37359","cloroutine.impl/coroutine","G__37360","cljs.core.object_array","cr37262-block-0","missionary.core/sp-run","fexpr__37326","missionary.core/dfv","fexpr__37327","G__37356","G__37357","G__37358","fexpr__37355","missionary.core/join","G__37339","G__37340","fexpr__37338","x","cr37265-state","cr37265-place-0","cr37265-block-1","e37271","e37332","cr37265-exception","cr37265-place-1","cr37265-place-2","cr37265-place-3","cr37265-place-4","e37272","e37333","G__37275","cr37265-block-0","G__37274","fexpr__37273","G__37335","fexpr__37334","!","G__37337","fexpr__37336","p1__37261#","G__37352","G__37353","G__37354","fexpr__37351","cr37279-state","cr37279-place-0","cr37279-block-1","e37285","e37345","cr37279-exception","cr37279-place-1","cr37279-place-2","cr37279-place-3","cr37279-place-4","e37286","e37346","G__37289","cr37279-block-0","G__37288","fexpr__37287","G__37348","fexpr__37347","G__37350","fexpr__37349","hyperfiddle.electric/failure?","var_args","G__37363","hyperfiddle.electric/task->cp","js/Error","!x","hyperfiddle.electric.task__GT_cp","pending","cr37364-state","cr37364-place-0","cr37364-block-1","cr37364-exception","e37367","cr37364-place-1","e37368","G__37369","cr37364-block-0","missionary.core/ap-run","missionary.core.reductions","unused__13640__auto__","self__","G__37371","args37370","cljs.core/aclone","this__5330__auto__","writer__5331__auto__","opt__5332__auto__","cljs.core/-write","hyperfiddle.electric/Clock","hyperfiddle.electric/->Clock","raf","callback","terminator","_","js/window","hyperfiddle.electric/<clock","n","t","cancel","args__5775__auto__","len__5769__auto__","i__5770__auto__","argseq__5776__auto__","cljs.core/IndexedSeq","hyperfiddle.electric/-get-system-time-ms","p__37373","vec__37374","cljs.core.nth","seq37372","self__5755__auto__","cljs.core/seq","js/Date.now","hyperfiddle.electric/dom-listener","node","typ","f","opts","cljs.core/clj->js","G__37379","hyperfiddle.electric/listen>","event-type","hyperfiddle.electric.listen_GT_","cljs.core/identity","keep-fn!","missionary.core/relieve","missionary.core/observe","p1__37377#","temp__5808__auto__","v","hyperfiddle.electric/<dom-visibility-state","js/document","missionary.core.latest","hyperfiddle.electric/-check-fn-arity!","name","expected","actual","cljs.core.not_EQ_","cljs.core.ex_info","or__5045__auto__","cljs.core.pr_str","hyperfiddle.electric/watchable?","cljs.core/native-satisfies?","cljs.core/IWatchable","hyperfiddle.electric/checked-watch","missionary.core/watch","hyperfiddle.electric/-invalid-watch-usage-message","G__37383","hyperfiddle.electric/debounce-discreet","delay","flow","hyperfiddle.electric.debounce_discreet","init","cr37384-state","cr37384-place-1","cr37384-place-2","cr37384-place-3","cr37384-block-2","cr37384-exception","e37402","cr37384-place-16","cr37384-place-17","e37403","cr37384-block-12","cr37384-place-15","cr37384-block-8","e37404","cr37384-place-12","e37405","cr37384-place-13","cr37384-place-14","cr37384-block-7","cr37384-block-6","e37406","cr37384-place-8","e37407","cr37384-block-4","cr37384-place-21","cr37384-block-11","e37408","cr37384-place-18","cr37384-place-19","cr37384-place-20","missionary.core/none","cr37384-block-10","missionary.core/fork","e37409","cr37384-place-0","cr37384-block-1","missionary.core/switch","e37410","e37411","cr37384-place-9","cr37384-place-10","cr37384-place-11","cr37384-block-9","cr37384-block-5","e37412","cr37384-place-22","e37413","cr37384-place-4","cr37384-place-5","cr37384-place-6","cr37384-place-7","cr37384-block-3","e37414","G__37418","cr37384-block-0","G__37416","G__37417","fexpr__37415","missionary.core/sleep","js/missionary.Cancelled","hyperfiddle.electric/throttle","dur",">in","cr37419-state","cr37419-place-5","cr37419-place-6","cr37419-place-7","missionary.core/seed","cr37419-place-8","cljs.core/range","cr37419-place-9","cr37419-place-10","cr37419-place-11","cr37419-block-2","cr37419-exception","e37440","cr37419-place-14","e37445","cr37419-place-15","cr37419-block-8","e37446","cr37419-place-12","cr37419-place-13","G__37448","cr37419-block-3","cr37419-block-4","cr37419-block-7","e37447","cr37419-place-22","e37449","cr37419-place-19","cr37419-place-20","cr37419-place-21","cr37419-block-6","e37450","cr37419-place-0","cr37419-place-1","cr37419-place-2","cr37419-place-3","cr37419-place-4","cr37419-block-1","e37451","cr37419-place-23","cr37419-place-24","cr37419-place-25","cr37419-place-26","cr37419-place-27","e37455","cr37419-place-16","cr37419-place-17","cr37419-place-18","cr37419-block-5","e37456","G__37459","cr37419-block-0","G__37453","G__37454","fexpr__37452","G__37442","fexpr__37441","G__37444","fexpr__37443","G__37458","fexpr__37457","hyperfiddle.electric/*http-request*","hyperfiddle.electric/-snapshot","missionary.core.eduction","contrib.data/take-upto","cljs.core/complement","hyperfiddle.electric.impl.runtime/pending","hyperfiddle.electric/->Object","js/Object","hyperfiddle.electric/pending"],"sourcesContent":["(ns hyperfiddle.electric\r\n  (:refer-clojure :exclude [eval def defn fn for empty? partial])\r\n  (:require [clojure.core :as cc]\r\n            contrib.data\r\n            [contrib.cljs-target :refer [do-browser]]\r\n            [contrib.missionary-contrib :as mx]\r\n            contrib.data\r\n            [hyperfiddle.electric.impl.compiler :as c]\r\n            [hyperfiddle.electric.impl.runtime :as r]\r\n            [hyperfiddle.electric.impl.for :refer [map-by]]\r\n            #?(:clj [hyperfiddle.rcf.analyzer :as ana])     ; todo remove\r\n            [missionary.core :as m]\r\n            #?(:cljs [hyperfiddle.electric-client])\r\n            [hyperfiddle.electric.impl.io :as io]\r\n            [hyperfiddle.electric.debug :as dbg])\r\n  #?(:cljs (:require-macros [hyperfiddle.electric :refer [def defn fn boot for for-by local run debounce wrap on-unmount]]))\r\n  (:import #?(:clj (clojure.lang IDeref))\r\n           (hyperfiddle.electric Pending Failure FailureInfo)\r\n           (missionary Cancelled)))\r\n\r\n;; Equality semantics for Failure and Pending\r\n;; For JVM, defined in java class.\r\n#?(:cljs\r\n   (extend-type Pending\r\n     IEquiv\r\n     (-equiv [this other]\r\n       (instance? Pending other))))\r\n\r\n#?(:cljs\r\n   (extend-type Failure\r\n     IEquiv\r\n     (-equiv [this other]\r\n       (and (instance? Failure other)\r\n            (= (.-error this) (.-error other))))))\r\n\r\n#?(:cljs (set! (.. FailureInfo -prototype -__proto__) cljs.core/ExceptionInfo.prototype))\r\n#?(:cljs\r\n   (extend-type FailureInfo\r\n     IEquiv\r\n     (-equiv [this other]\r\n       (and (instance? FailureInfo other)\r\n            (= (.-cause this) (.-cause other))))))\r\n\r\n#?(:clj\r\n   (do\r\n     ;; Optionally, tell RCF not to rewrite Electric programs.\r\n     (defmethod ana/macroexpand-hook `hyperfiddle.electric/run [the-var form env args] (reduced `(hyperfiddle.electric/run ~@args))) ; optional\r\n     ;;(defmethod ana/macroexpand-hook `hyperfiddle.electric/run2 [_the-var _form _env args] `(hyperfiddle.electric/run2 ~@args))\r\n\r\n     ;; Don't expand cc/binding (prevent infinite loop). Explicit implicit do\r\n     (defmethod ana/macroexpand-hook 'clojure.core/binding [_the-var _form _env [bindings & body]] (reduced `(binding ~bindings (do ~@body))))\r\n     (defmethod ana/macroexpand-hook 'cljs.core/binding [_the-var _form _env [bindings & body]] (reduced `(binding ~bindings (do ~@body))))))\r\n\r\n(def eval \"Takes a resolve map and a program, returns a booting function.\r\n  The booting function takes\r\n  * as first argument a function Any->Task[Unit] returned task writes the value on the wire.\r\n  * as second argument a flow producing the values read on the wire.\r\n  and returning a task that runs the local reactor.\"\r\n  r/eval)\r\n\r\n(def hook r/hook)\r\n(def bind r/bind) ; for when you want to spawn a e/fn without a new\r\n(def with r/with)\r\n\r\n(cc/defn pair [c s]\r\n  (m/sp\r\n    (let [s->c (m/dfv)\r\n          c->s (m/dfv)]\r\n      (m/?\r\n        (m/join {}\r\n          (s (cc/fn [x] (m/sp ((m/? s->c) x)))\r\n            (cc/fn [!] (c->s !) #()))\r\n          (c (cc/fn [x] (m/sp ((m/? c->s) x)))\r\n            (cc/fn [!] (s->c !) #())\r\n            #(throw %)))))))\r\n\r\n(defmacro local\r\n  \"Single peer loopback system without whitelist. Returns boot task.\"\r\n  [& body]\r\n                                        ; use compiler (client) because no need for exports\r\n  (let [[client server] (c/analyze &env `(do ~@body))]\r\n    `(pair ~(r/emit (gensym) client) ~(r/emit (gensym) server))))\r\n\r\n(defmacro run \"test entrypoint without whitelist.\" [& body]\r\n  `((local ~@body) (cc/fn [_#]) (cc/fn [_#])))\r\n\r\n(cc/defn failure? [x] (instance? Failure x))\r\n\r\n#?(:clj\r\n   (cc/defn -offload [thunk executor]\r\n     (->> (m/ap (m/? (m/via executor (thunk)))) ; run once\r\n       (m/reductions {} (Failure. (Pending.)))\r\n       (m/relieve {}))))\r\n\r\n(defmacro offload\r\n  \"run a blocking function (i.e. query) on threadpool specified by `executor` (i.e. m/blk or m/cpu).\r\nIO-bound fns should use m/blk, which is the default. Compute-bound fns should pass m/cpu. Custom\r\nexecutors are allowed (i.e. to control max concurrency, timeouts etc). Currently JVM only.\"\r\n  ([f! executor] `(new (-offload ~f! ~executor))) ; rebuild flow and cancel old thread\r\n  ; no varadic arity, user should explicitly state unit of work, so no ambiguity about concurrent tasks\r\n  ([f!] `(new (-offload ~f! m/blk))))\r\n\r\n(defmacro ^:deprecated wrap \"Deprecated. Use `offload` instead.\" [& body] `(offload #(do ~@body)))\r\n\r\n; Should these be in missionary?\r\n;(def chan-read! contrib.missionary-contrib/chan-read!)\r\n;(def chan->ap contrib.missionary-contrib/chan->ap)\r\n;(def chan->task contrib.missionary-contrib/chan->task)\r\n;(def chan->cp contrib.missionary-contrib/chan->cp)\r\n\r\n(cc/defn task->cp ; leo to review\r\n  ([!x] (task->cp !x (Failure. (Pending.)))) ; note Electric dependency\r\n  ([!x pending] (->> (m/ap (m/? !x)) (m/reductions {} pending))))\r\n\r\n; Moved to contrib.missionary-contrib\r\n;(defmacro use-channel ;; TODO rename\r\n;  ([chan] `(use-channel nil ~chan))\r\n;  ([init chan] `(new (m/reductions {} ~init (chan->ap ~chan)))))\r\n\r\n#?(:cljs\r\n   (deftype Clock [^:mutable ^number raf\r\n                   ^:mutable callback\r\n                   terminator]\r\n     IFn                                                    ; cancel\r\n     (-invoke [_]\r\n       (if (zero? raf)\r\n         (set! callback nil)\r\n         (do (.cancelAnimationFrame js/window raf)\r\n             (terminator))))\r\n     IDeref                                                 ; sample\r\n     (-deref [_]\r\n       ; lazy clock, only resets once sampled\r\n       (if (nil? callback)\r\n         (terminator)\r\n         (set! raf (.requestAnimationFrame js/window callback))) ; RAF not called until first sampling\r\n       ::tick)))\r\n\r\n; cc def, must be above defmacro def\r\n(def ^:no-doc <clock \"lazy & efficient logical clock that schedules no work unless sampled\"\r\n  #?(:cljs (cc/fn [n t]\r\n             (let [cancel (->Clock 0 nil t)]\r\n               (set! (.-callback cancel)\r\n                 (cc/fn [_] (set! (.-raf cancel) 0) (n)))\r\n               (n) cancel))\r\n     \r\n     ; 120 hz server, careful this impacts bandwidth in demo-two-clocks\r\n     ; typical UI animation rate is 60 or 120hz, no point in going higher \r\n     :clj (m/ap (loop [] (m/amb nil (do (m/? (m/sleep (/ 1000 120))) (recur)))))\r\n     #_(m/ap (m/? (m/sleep 1 (m/?> (m/seed (repeat nil))))))))\r\n\r\n;; --------------------------------------\r\n\r\n(defmacro def\r\n  ([symbol] `(hyperfiddle.electric/def ~symbol ::c/unbound))\r\n  ([symbol docstring init]\r\n   (assert (string? docstring))\r\n   (#'def &form &env (vary-meta symbol assoc :doc docstring) init))\r\n  ([symbol init]\r\n   ;; GG: Expand to an unbound var with body stored in ::c/node meta.\r\n   ;;     Clojure compiler will analyze vars metas, which would analyze form as clojure, so we quote it.\r\n   ;;     ClojureScript do not have vars at runtime and will not analyze or emit vars meta. No need to quote.\r\n   `(def ~(vary-meta symbol assoc ::c/node (if (:js-globals &env) init `(quote ~init))))))\r\n\r\n(cc/defn -get-system-time-ms [& [_]] #?(:clj (System/currentTimeMillis) :cljs (js/Date.now)))\r\n\r\n; DOM event utilities promoted due to visibility-state being critical\r\n\r\n#?(:cljs (cc/defn dom-listener [node typ f opts] \r\n           (.addEventListener node typ f (clj->js opts))\r\n           #(.removeEventListener node typ f)))\r\n\r\n#?(:cljs (cc/defn listen>\r\n           ([node event-type] (listen> node event-type identity {}))\r\n           ([node event-type keep-fn!] (listen> node event-type keep-fn! {}))\r\n           ([node event-type keep-fn! opts]\r\n            (m/relieve {}\r\n              (m/observe (cc/fn [!]\r\n                           (dom-listener node event-type #(when-some [v (keep-fn! %)]\r\n                                                            (! v)) opts)))))))\r\n\r\n#?(:cljs (def <dom-visibility-state \r\n           (do-browser \r\n             (->> (listen> js/document \"visibilitychange\")\r\n               (m/reductions {} (.-visibilityState js/document))\r\n               (m/latest (cc/fn [_] (.-visibilityState js/document)))))))\r\n\r\n(hyperfiddle.electric/def dom-visibility-state (client (new (identity <dom-visibility-state)))) ; starts Pending on server\r\n\r\n(hyperfiddle.electric/def dom-mousemove \"mousemove events, Pending if unknown\"\r\n  (client (new (m/reductions {} r/pending (e/listen> js/document \"mousemove\")))))\r\n\r\n(hyperfiddle.electric/def system-time-ms \"ms since 1970 Jan 1\" \r\n  (if (= \"visible\" dom-visibility-state)\r\n    (new (m/sample -get-system-time-ms <clock))\r\n    (throw (Pending.)))) ; tab is hidden, no clock. (This guards NPEs in userland)\r\n\r\n(hyperfiddle.electric/def system-time-secs \"seconds since 1970 Jan 1\" (/ system-time-ms 1000.0))\r\n\r\n(cc/defn -check-fn-arity! [name expected actual]\r\n  (when (not= expected actual)\r\n    (throw (ex-info (str \"You called \" (or name (pr-str ::unnamed-efn)) \", a \" expected \"-arg e/fn with \" actual \" arguments.\")\r\n             {:name name}))))\r\n\r\n;; TODO self-refer\r\n(defmacro fn [name? & [args & body]]\r\n  (let [[name? args body] (if (symbol? name?) [name? args body]\r\n                              [nil name? (cons args body)])]\r\n    (if (bound? #'c/*env*)\r\n      `(::c/closure\r\n        ;; Beware, `do` is implemented with `m/latest`, which evaluates\r\n        ;; arguments in parallel. The e/fn body will be called even if arity is\r\n        ;; incorrect, then the arity exception will be thrown. This might be\r\n        ;; confusing to users in presence of effects. Same as `(do (assert\r\n        ;; false) (prn 42))`: 42 is printed anyway. This is a broader question\r\n        ;; than \"what should the semantics of e/fn should be\", so we decided to\r\n        ;; be consistent with the current model and to not introduce a specific\r\n        ;; behavior for e/fn.\r\n        (do (-check-fn-arity! '~name? ~(count args) c/%arity)\r\n            (binding [c/rec (::c/closure (let [~@(interleave args c/arg-sym)] ~@body))]\r\n              (new c/rec ~@(take (count args) c/arg-sym))))\r\n        ~{::dbg/name name?, ::dbg/args args, ::dbg/type (or (::dbg/type (meta name?)) :reactive-fn)\r\n          ::dbg/meta (merge (select-keys (meta &form) [:file :line])\r\n                       (select-keys (meta name?) [:file :line]))})\r\n      `(throw (ex-info \"Invalid e/fn in Clojure code block (use from Electric code only)\" ~(into {} (meta &form)))))))\r\n\r\n; syntax quote doesn't qualify special forms like 'def\r\n(defmacro defn [sym & fdecl]\r\n  (let [[_defn sym' & _] (macroexpand `(cc/defn ~sym ~@fdecl))] ; GG: docstring support\r\n    `(hyperfiddle.electric/def ~sym' (hyperfiddle.electric/fn ~(vary-meta sym' merge {::dbg/type :reactive-defn}\r\n                                                                          (meta &form)\r\n                                                                          (meta sym'))\r\n                                                              ~@(if (string? (first fdecl)) ; GG: skip docstring\r\n                                         (rest fdecl)\r\n                                         fdecl)))))\r\n\r\n(defmacro for-by [kf bindings & body]\r\n  (if-some [[s v & bindings] (seq bindings)]\r\n    `(let [xs# ~v]\r\n       (new (r/bind map-by ~kf\r\n              ~(->> body\r\n                 (list* `for-by kf bindings)\r\n                 (list `let [s (first c/arg-sym)])\r\n                 (list `fn [])\r\n                 (list `cc/partial (list ::c/inject (first c/arg-sym))))\r\n              (::c/lift xs#))))\r\n    (cons `do body))) ; todo, buggy: (e/for [x []] (println 42)) should not print\r\n\r\n(defmacro for [bindings & body]\r\n  `(hyperfiddle.electric/for-by identity ~bindings ~@body))\r\n\r\n(cc/defn ^:no-doc watchable? [x]\r\n  #?(:clj (instance? clojure.lang.IRef x)\r\n     :cljs (satisfies? IWatchable x)))\r\n\r\n(cc/defn ^:no-doc checked-watch [!x]\r\n  (assert (watchable? !x) \"Provided argument is not Watchable.\")\r\n  (m/watch !x))\r\n\r\n(def -invalid-watch-usage-message \"Invalid e/watch (use from Electric code only, maybe you forgot a e/def?)\")\r\n\r\n(defmacro watch \"Derive a reactive value from a Clojure atom or reference.\"\r\n  [!x]\r\n  (if (bound? #'c/*env*)\r\n    `(new (checked-watch ~!x))\r\n    `(throw (ex-info -invalid-watch-usage-message ~(into {} (meta &form))))))\r\n\r\n(cc/defn debounce-discreet\r\n  ([delay flow] (debounce-discreet delay nil flow))\r\n  ([delay init flow] (m/reductions {} init (m/ap (let [x (m/?< flow)]\r\n                                                   (try (m/? (m/sleep delay x))\r\n                                                        (catch Cancelled _ (m/amb))))))) )\r\n\r\n(defmacro ^:deprecated debounce ; immoral? introduces avoidable delays\r\n  \"Debounce a continous flow by `delay` milliseconds.\"\r\n  [delay flow]\r\n  `(new (->> (fn [] ~flow)\r\n             (debounce-discreet ~delay)\r\n             (m/relieve {}))))\r\n\r\n(cc/defn throttle [dur >in] ; in CLJ, wrong number of args (1) passed to: hyperfiddle.electric-ui4/long --- ?????\r\n  (m/ap\r\n    (let [x (m/?> (m/relieve {} >in))]\r\n      (m/amb x (do (m/? (m/sleep dur)) (m/amb))))))\r\n\r\n(defmacro ^:deprecated remote [& body]\r\n  (if (= 1 (count body))\r\n    `(unquote-splicing ~@body)\r\n    `(unquote-splicing (do ~@body))))\r\n\r\n(defmacro client [& body]\r\n  (if (bound? #'c/*env*)\r\n    `(::c/client (do ~@body) ~(assoc (meta &form) ::dbg/type :transfer, ::dbg/name ::client))\r\n    `(throw (ex-info \"Invalid e/client in Clojure code block (use from Electric code only)\" ~(into {} (meta &form))))))\r\n\r\n(defmacro server [& body]\r\n  (if (bound? #'c/*env*)\r\n    `(::c/server (do ~@body) ~(assoc (meta &form) ::dbg/type :transfer, ::dbg/name ::server))\r\n    `(throw (ex-info \"Invalid e/server in Clojure code block (use from Electric code only)\" ~(into {} (meta &form))))))\r\n\r\n(defmacro discard\r\n  \"Silence \\\"Unserializable reference transfer\\\"; inlining `(do ... nil)` is idiomatic as well\"\r\n  [& body] `(do ~@body nil))\r\n\r\n(hyperfiddle.electric/def trace \"In a `catch` block, bound by the runtime to the current stacktrace. An Electric stacktrace is an ExceptionInfo. Use `hyperfiddle.electric.debug/stack-trace` to get a string representation.\" nil)\r\n\r\n(defmacro lexical-env \"Return a map containing lexical bindings\" []\r\n  (let [env (if (:js-globals &env) (:locals &env) &env)]\r\n    (with-meta\r\n      `{:env ~(reduce-kv (cc/fn [r k v] (assoc r (list 'quote k) k)) (empty env) env)}\r\n      (meta &form))))\r\n\r\n(defmacro with-cycle\r\n  \"evaluates body with symbol s bound to the previous result of the body evaluation.\r\n  the first evaluation binds s to i.\"\r\n  [[s i] & body]\r\n  `(let [a# (atom ~i) ~s (hyperfiddle.electric/watch a#)]\r\n     (reset! a# (do ~@body))))\r\n\r\n(defmacro partial-dynamic\r\n  \"Return a function calling given function `f` with given dynamic environment.\"\r\n  [bindings f]\r\n  `(cc/fn [& args#] (binding ~bindings (apply ~f args#))))\r\n\r\n(defmacro partial\r\n  \"Like `cc/partial` for reactive functions. Requires the target function\r\n  arity (`argc`) until reactive function supports variadic arguments.\r\n\r\n  e.g. (new (partial 2 (e/fn [a b] [a b]) :a) :b) ;; => [:a :b]\"\r\n  [argc F & args]\r\n  (if (= 0 argc)\r\n    F\r\n    (let [rest-args (map #(symbol (str \"arg_\" %)) (range (- argc (count args))))]\r\n      `(let [F# ~F]\r\n         (hyperfiddle.electric/fn ~@(when (symbol? F) [F]) [~@rest-args]\r\n                                  (new F# ~@args ~@rest-args))))))\r\n\r\n(defmacro on-unmount \"Run clojure(script) thunk `f` during unmount.\r\n\r\n  Standard electric code runs on mount, therefore there is no `on-mount`.\"\r\n  [f] `(new (m/observe (cc/fn [!#] (!# nil) ~f)))) ; experimental\r\n\r\n(defn ?PrintServerException [id]\r\n  (try (server\r\n         (when-some [ex (io/get-original-ex id)]\r\n           (println ex)\r\n           (try (client (js/console.log \"server logged the root exception\"))\r\n                (catch Pending _))))\r\n       (catch Pending _)))\r\n\r\n(defmacro with-zero-config-entrypoint [& body]\r\n  `(try\r\n     (do ~@body)\r\n     (catch Pending _#)                 ; silently ignore\r\n     (catch Cancelled e# (throw e#))    ; bypass catchall, app is shutting down\r\n     (catch :default err#               ; note client bias\r\n       (js/console.error\r\n         (str (ex-message err#) \"\\n\\n\" (dbg/stack-trace hyperfiddle.electric/trace)) \"\\n\\n\"\r\n         (or (io/get-original-ex (dbg/ex-id hyperfiddle.electric/trace)) err#))\r\n       (new ?PrintServerException (dbg/ex-id hyperfiddle.electric/trace)))))\r\n\r\n(defmacro boot \"\r\nTakes an Electric program and returns a task setting up the full system with client part running locally and server part\r\nrunning on a remote host.\r\n\" [& body]\r\n  (assert (:js-globals &env))\r\n  (let [[client server] (c/analyze\r\n                          (assoc &env ::c/peers-config {::c/local :cljs ::c/remote :clj})\r\n                          `(with-zero-config-entrypoint ~@body))]\r\n    `(hyperfiddle.electric-client/reload-when-stale\r\n      (hyperfiddle.electric-client/boot-with-retry\r\n       ~(r/emit (gensym) client)\r\n       (hyperfiddle.electric-client/connector (quote ~server))))))\r\n\r\n;; WIP: user space socket reconnection\r\n\r\n#_\r\n(hyperfiddle.electric/def ^{:doc \"\r\n`true` if the main process was cancelled, `false` otherwise.\r\n\"} cancelled (new r/cancelled))\r\n\r\n#_\r\n(hyperfiddle.electric/def ^{:doc \"\r\n`true` if the link to the remote peer is up, `false` otherwise. May throw Pending during connection.\r\n\"} connected (new r/connected))\r\n\r\n#_\r\n(hyperfiddle.electric/defn Entrypoint [App]\r\n  (or cancelled\r\n    (not= :waiting\r\n      (with-cycle [s {:status :connecting :delay 1000}]\r\n        (try (App.) (catch :default e (.error js/console e)))\r\n        (case (:status s)\r\n          :waiting (let [{:keys [since delay]} s\r\n                         remaining (-> since (+ delay) (- time))]\r\n                     (if (pos? remaining)\r\n                       (do (println (str \"Retrying in \" (int (/ remaining 1000)) \"s.\")) s)\r\n                       (do (println \"Connecting...\")\r\n                           (-> s\r\n                             (dissoc :since)\r\n                             (assoc :status :connecting)))))\r\n          :connecting (try (if connected\r\n                             (do (println \"Connected.\")\r\n                                 (-> s\r\n                                   (dissoc :delay)\r\n                                   (assoc :status :connected)))\r\n                             (do (println \"Failed to reconnect.\")\r\n                                 (-> s\r\n                                   (update :delay * 2)\r\n                                   (assoc :status :waiting\r\n                                          :since time))))\r\n                           (catch Pending _ s))\r\n          :connected (if connected\r\n                       s (do (println \"Connection reset.\")\r\n                             {:status :waiting\r\n                              :since  time\r\n                              :delay  1000})))))))\r\n\r\n(def ^:dynamic *http-request* \"Bound to the HTTP request of the page in which the current Electric program is running.\" nil)\r\n\r\n(defmacro check-electric [fn form]\r\n  (if (bound? #'c/*env*)\r\n    form\r\n    (throw (ex-info (str \"Electric code (\" fn \") inside a Clojure function\") (into {:electric-fn fn} (meta &form))))))\r\n\r\n(cc/defn -snapshot [flow] (->> flow (m/eduction (contrib.data/take-upto (complement #{r/pending})))))\r\n\r\n(defmacro snapshot \r\n  \"Snapshots the first non-Pending value of reactive value `x` and freezes it, \r\ninhibiting all further reactive updates.\" \r\n  [x] `(check-electric snapshot (new (-snapshot (hyperfiddle.electric/fn [] ~x)))))\r\n\r\n(cc/defn ->Object [] #?(:clj (Object.) :cljs (js/Object.))) ; private\r\n\r\n;; low-level, most powerful, hardest to use\r\n(defmacro for-event\r\n  ; Progress in UI is a continuous flow (succession of values) that eventually completes with a final result.\r\n  \"For each value of >flow, spawn concurrent `body` branches which individually \r\nprogress towards completion. Keeps each branch alive to progress in isolation \r\nuntil it signals completion by returning a reduced value, at which point the branch\r\nis unmounted. Returns active progress values as a vector. Exceptions bubble out.\"\r\n  [[sym >flow] & body]\r\n  `(let [mbx# (m/mbx)]\r\n     (new (m/reductions {} nil (m/eduction (map #(mbx# [::mx/add (->Object) %])) ~>flow)))\r\n     (for-by first [[progressing-event# ~sym] (new (mx/document (mx/poll-task mbx#)))]\r\n       (let [v# (do ~@body)]\r\n         (if (reduced? v#)\r\n           (do (mbx# [::mx/retract progressing-event#]) nil)\r\n           v#)))))\r\n\r\n(def pending (Pending.))\r\n\r\n;; high-level wrapper of above, returns a union type, waits for non-Pending value\r\n(defmacro for-event-pending\r\n  \"Like for-event, but each branch completes as soon as a non-Pending value or \r\nexception is available. Returns [::pending e/pending] if there are one or more\r\nuncompleted branches, otherwise returns a 4-colored result corresponding to the\r\nprogress of the most recently completed branch.\"\r\n  [bind & body]\r\n  `(let [!state# (atom [::init]), state# (hyperfiddle.electric/watch !state#)]\r\n     (if (seq (for-event ~bind\r\n                (try (reduced (reset! !state# [::ok (do ~@body)]))\r\n                     (catch Pending ex#)\r\n                     (catch Cancelled ex# (reduced nil))\r\n                     (catch ~(if (:ns &env) :default `Throwable) ex# \r\n                       (reduced (reset! !state# [::failed ex#]))))))\r\n       [::pending pending] ; save Pending exception for easy re-throw\r\n       state#)))\r\n\r\n;; e/for-event-pending-switch is similar to m/?<. \r\n;; When a new event comes in a new branch is immediately spawned and the previous cancelled\r\n;; ok, so these operators are basically the equivalent of m/?< m/?> and m/?= extended into continuous time. \r\n;; one runs events concurrently, one runs events sequentially, and one interrupts\r\n;; for-event-sequence, for-event-concurrent, for-event-interrupt\r\n(defmacro for-event-pending-switch ; for-event?<\r\n  \"Like for-event, but each new event supersedes the prior event, canceling and \r\ndiscarding previous it even if in progress. The single active branch completes \r\non the first non-Pending value. Returns a single four-colored result \r\ncorresponding to the progress of the most recent event.\"\r\n  [[sym >flow :as bind] & body]\r\n  `(let [!i# (atom 0), i# (hyperfiddle.electric/watch !i#)\r\n         !state# (atom [::init]), state# (hyperfiddle.electric/watch !state#)]\r\n     (if (seq (for-event ~bind\r\n                (try (when (<= i# (inc @!i#)) \r\n                       (reset! !state# [::ok (do ~@body)])) \r\n                  (reduced (swap! !i# inc))\r\n                  (catch Pending ex#)\r\n                  (catch Cancelled ex# (reduced nil))\r\n                  (catch ~(if (:ns &env) :default `Throwable) \r\n                    ex# (reduced (reset! !state# [::failed ex#]))))))\r\n       [::pending pending] state#)))\r\n\r\n(defmacro do-event ; for-one-event\r\n  \"Run `body` continuation in response to next event (silently discarding subsequent \r\nevents) until it completes by evaluating to a `reduced` value. On completion, \r\nunmounts the body, returning nil while waiting for a fresh event.\"\r\n  ; Useful for button case because it discards. Not useful for create-new, because it discards.\r\n  ; Does this blink-and-clear on completion?\r\n  \r\n  [[sym >flow] & body]\r\n  `(let [!e# (atom nil)]\r\n     (new (m/reductions #(swap! !e# (cc/fn [cur#] ; latch first non-nil event\r\n                                      (if (nil? cur#) %2 cur#))) ; discarding events until event processing completes\r\n            nil ~>flow))\r\n     (when-some [~sym (hyperfiddle.electric/watch !e#)] ; wait for non-nil event (rising edge), bind in scope for body\r\n       (let [v# (do ~@body)] ; nil is insignificant here\r\n         (if (reduced? v#) ; never seen\r\n           (reset! !e# nil) ; reset, unmount body, wait for fresh event\r\n           v#)))))\r\n\r\n(defmacro do-event-pending\r\n  \"Run `body` continuation in response to next event (silently discarding subsequent \r\nevents) until it completes by evaluating to a non-Pending result. On completion, \r\nunmounts the body, latches and returns the 4-colored result while waiting for a \r\nfresh event.\"\r\n  [[sym >flow :as bind] & body]\r\n  `(let [!state# (atom [::init])]\r\n     (do-event ~bind\r\n       ; D: Why not leave the body alive, is the signal state the same as this explicit latch?\r\n       (try (reduced (reset! !state# [::ok (do ~@body)])) ; latch result\r\n            (catch Pending ex# (reset! !state# [::pending pending])) ; wait longer\r\n            (catch Cancelled ex# (reduced nil))\r\n            (catch ~(if (:ns &env) :default `Throwable) ex#\r\n              (reduced (reset! !state# [::failed ex#]))))) ; latch result\r\n     (hyperfiddle.electric/watch !state#)))"]}