{"version":3,"sources":["hyperfiddle/electric_ui5.cljc"],"mappings":";AAoBA,AACA,AAAKA,yCAAQ,AAACC,gDAAQC,qBAAKC","names":["hyperfiddle.electric-ui5/tempid?","cljs.core.some_fn","cljs.core/nil?","cljs.core/string?"],"sourcesContent":["(ns hyperfiddle.electric-ui5\n  #?(:cljs (:require-macros hyperfiddle.electric-ui5))\n  (:refer-clojure :exclude [long double keyword symbol uuid range])\n  (:require clojure.edn\n            contrib.str\n            [hyperfiddle.electric :as e]\n            [hyperfiddle.electric-dom2 :as dom]\n            [missionary.core :as m]\n            [contrib.debug :as dbg]))\n\n(defmacro control [event-type parse unparse v V! setter & body]\n  `(let [[state# v#] (e/for-event-pending-switch [e# (e/listen> dom/node ~event-type)]\n                       (some->> (~parse e#) (new ~V!)))]\n     #_(dom/style {:background-color (when (= ::e/pending state#) \"yellow\")})\n     ; workaround \"when-true\" bug: extra outer when-some added to guard a nil from incorrectly sneaking through\n     (when-some [v# (when (and (not (new dom/Focused?)) (#{::e/init ::e/ok} state#)) ~v)]\n       (~setter dom/node (~unparse v#))) ; js coerce\n     ~@body\n     [state# v#]))\n\n(e/def local?)\n(def tempid? (some-fn nil? string?))\n\n(defmacro entity [record EnsureEntity & body]\n  `(let [[state# e#] (new ~EnsureEntity (:db/id ~record) ~record)]\n     (case state# ::e/failed (.error js/console e#) nil)\n     ;; mark entity local for downstream code\n     (binding [local? (tempid? (:db/id ~record))]\n       ~@body)))\n\n(defmacro input [v V! & body]\n  `(dom/input\n     (let [[state# v#] (control \"input\" #(-> % .-target .-value) identity ~v ~V! dom/set-val)\n           color# (if local? \"blue\" (case state# ::e/init \"gray\", ::e/ok \"green\", ::e/pending \"yellow\", ::e/failed \"red\"))]\n       (dom/style {:border-width \"2px\", :border-style \"solid\", :border-color color#, :border-radius \"0.2em\"})\n       (when local? (dom/props {:disabled true}))\n       (case state# ::e/failed (.error js/console v#) nil)\n       ~@body)))\n\n(defmacro checkbox [v V! & body]\n  `(dom/input (dom/props {:type \"checkbox\"})\n     (let [[state# v#] (control \"change\" #(-> % .-target .-checked) identity ~v ~V! #(set! (.-checked %) %2))\n           color# (if local? \"blue\" (case state# ::e/init \"gray\", ::e/ok \"green\", ::e/pending \"yellow\", ::e/failed \"red\"))]\n       (dom/style {:outline-width \"2px\", :outline-style \"solid\", :outline-color color#})\n       (when local? (dom/props {:disabled true}))\n       (case state# ::e/failed (.error js/console v#) nil)\n       ~@body)))\n"]}