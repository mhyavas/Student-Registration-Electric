{"version":3,"sources":["contrib/oklab.cljc"],"mappings":";AAQA,4BAAA,5BAAMA,gEAAUC;AAAhB,AAAuB,4BAAA,pBAAG,CAAGA,QAAMC;;AAEnC,gCAAA,wCAAAC,xEAAMG;AAAN,AAAA,IAAAF,aAAAD;QAAA,AAAAE,4CAAAD,WAAA,IAAA,/DAAqBG;QAArB,AAAAF,4CAAAD,WAAA,IAAA,/DAAuBI;QAAvB,AAAAH,4CAAAD,WAAA,IAAA,/DAAyBK;AAAzB,AAAA,0FACGF,EACA,CAAGC,IAAE,AAACE,SAAS,AAACV,0BAASS,KACzB,CAAGD,IAAE,AAACG,SAAS,AAACX,0BAASS;;AAE5B,+BAAA,uCAAAG,tEAAME;AAAN,AAAA,IAAAD,aAAAD;QAAA,AAAAP,4CAAAQ,WAAA,IAAA,/DAAoBN;QAApB,AAAAF,4CAAAQ,WAAA,IAAA,/DAAsBE;QAAtB,AAAAV,4CAAAQ,WAAA,IAAA,/DAAwBG;AAAxB,AAGE,IAAMC,IAAE,CAAA,CAAG,KAAA,JAAGV,0BAA0B,CAAA,sBAA0BQ,MAAG,CAAA,qBAA0BC;IACzFE,IAAE,CAAA,CAAG,KAAA,JAAGX,0BAAyB,CAAA,sBAAyBQ,MAAG,CAAA,sBAA2BC;IACxFG,IAAE,CAAA,CAAG,KAAA,JAAGZ,0BAAyB,CAAA,sBAA2BQ,MAAG,CAAA,qBAAyBC;IAExFC,QAAE,WAAA,XAACG,SAASH;IACZC,QAAE,WAAA,XAACE,SAASF;IACZC,QAAE,WAAA,XAACC,SAASD;AANlB,AAAA,0FAQG,CAAG,CAAG,CAAA,oBAAqBF,SAAG,CAAA,oBAAqBC,UAAI,CAAA,oBAAqBC,QAC5E,CAAG,CAAG,CAAA,sBAAuBF,SAAG,CAAA,qBAAsBC,UAAI,CAAA,qBAAsBC,QAChF,CAAG,CAAG,CAAA,wBAAyBF,SAAG,CAAA,qBAAsBC,UAAI,CAAA,qBAAsBC;;AAEvF,qBAAA,rBAAME,kDAAMC;AAAZ,AAAe,GAAM,KAAA,JAAGA;AAAT;;AAAA,GACM,KAAA,JAAGA;AADT;;AAAA,AAAA;;;;;AAIf,6BAAA,qCAAAC,lEAAME;AAAN,AAAA,IAAAD,aAAAD;QAAA,AAAAlB,4CAAAmB,WAAA,IAAA,/DAAkBE;QAAlB,AAAArB,4CAAAmB,WAAA,IAAA,/DAAoBG;QAApB,AAAAtB,4CAAAmB,WAAA,IAAA,/DAAsBR;AAAtB,AAEE,IAAMY,IAAE,WAAKpB;AAAL,AACE,IAAMqB,MAAI,AAACC,SAAStB;AAApB,AACE,GAAI,OAAA,NAAGqB;AACL,IAAME,IAAE,mCAAA,jCAAI,2BAAA,1BAAO,AAACV,mBAAKb,iBAAM,AAACa,mBAAKb;AAArC,AACE,QAAGuB,IAAE,uCAAA,tCAAG,CAAA,QAAS,AAACX,SAASS,IAAI,CAAA,MAAA;;AACjC,YAAA,JAAGrB;;;AALjB,AAAA,0FAMG,AAACoB,EAAEF,GAAG,AAACE,EAAED,GAAG,AAACC,EAAEZ;;AAEpB,8BAAA,9BAAMgB,oEAAYC;AAAlB,AAAuB,OAACR,2BAAU,AAACX,6BAAYmB;;AAC/C,8BAAA,9BAAMC,oEAAYC;AAAlB,AAAuB,OAACH,4BAAW,AAAC1B,8BAAa6B;;AAEjD,AASA","names":["contrib.oklab/deg->rad","alpha","Math/PI","p__36131","vec__36132","cljs.core.nth","contrib.oklab/oklch->oklab","l","c","h","Math/cos","Math/sin","p__36135","vec__36136","contrib.oklab/oklab->lrgb","a","b","L","M","S","Math/pow","contrib.oklab/sign","x","p__36140","vec__36141","contrib.oklab/lrgb->rgb","r","g","f","abs","Math/abs","s","contrib.oklab/oklab->rgb","lab","contrib.oklab/oklch->rgb","lch"],"sourcesContent":["(ns contrib.oklab\n  \"A perceptual color space.\n  https://bottosson.github.io/posts/oklab/\n\n  Specified by CSS Color Module Level 4. Available natively in Safari.\n  \"\n  (:require [hyperfiddle.rcf :refer [tests]]))\n\n(defn deg->rad [alpha] (/ (* alpha Math/PI) 180))\n\n(defn oklch->oklab [[l c h]]\n  [l\n   (* c (Math/cos (deg->rad h)))\n   (* c (Math/sin (deg->rad h)))])\n\n(defn oklab->lrgb [[l a b]]\n  ;; https://bottosson.github.io/posts/oklab/#converting-from-linear-srgb-to-oklab\n  ;; https://github.com/Evercoder/culori/blob/4ac59027cedc102905233424b84398b3fae0234c/src/oklab/convertOklabToLrgb.js#L1\n  (let [L (+ (* l 0.99999999845051981432) (* 0.39633779217376785678 a) (* 0.21580375806075880339 b))\n        M (- (* l 1.0000000088817607767) (* 0.1055613423236563494 a) (* 0.063854174771705903402 b))\n        S (- (* l 1.0000000546724109177) (* 0.089484182094965759684 a) (* 1.2914855378640917399 b))\n\n        L (Math/pow L 3)\n        M (Math/pow M 3)\n        S (Math/pow S 3)]\n\n    [(+ (- (* 4.076741661347994 L) (* 3.307711590408193 M)) (* 0.230969928729428 S))\n     (- (+ (* -1.2684380040921763 L) (* 2.6097574006633715 M)) (* 0.3413193963102197 S))\n     (+ (- (* -0.004196086541837188 L) (* 0.7034186144594493 M)) (* 1.7076147009309444 S))]))\n\n(defn sign [x] (cond (< x 0) -1\n                     (> x 0) 1\n                     :else   0))\n\n(defn lrgb->rgb [[r g b]]\n  ;; https://github.com/Evercoder/culori/blob/4ac59027cedc102905233424b84398b3fae0234c/src/lrgb/convertLrgbToRgb.js#L9\n  (let [f (fn [c]\n            (let [abs (Math/abs c)]\n              (if (> abs 0.0031308)\n                (let [s (if (zero? (sign c)) 1 (sign c))]\n                  (* s (- (* 1.055 (Math/pow abs (/ 1 2.4))) 0.055)))\n                (* c 12.92))))]\n    [(f r) (f g) (f b)]))\n\n(defn oklab->rgb [lab] (lrgb->rgb (oklab->lrgb lab)))\n(defn oklch->rgb [lch] (oklab->rgb (oklch->oklab lch)))\n\n(tests\n  (oklch->oklab [29.2345 44.2 27])    := [29.2345 39.382488369125866 20.066380088487968]\n  (oklch->oklab [52.2345 72.2 56.2])  := [52.2345 40.164543439122006 59.99707868160651]\n  (oklch->oklab [60.2345 59.2 95.2])  := [60.2345 -5.365448747708576 58.956356398065445]\n  (oklch->oklab [62.2345 59.2 126.2]) := [62.2345 -34.963855523099575 47.77205047891309]\n  (oklch->oklab [67.2345 42.5 258.2]) := [67.2345 -8.691082203276117 -41.60186402237161]\n  (oklch->oklab [29.69 45.553 327.1]) := [29.69 38.24720368913612 -24.7432257186029]\n  )\n\n(tests\n (oklab->rgb [0 0 0])          := [0.0 0.0 0.0]\n (oklab->rgb [0.18 0.18 0.18]) := [0.3291136203007484 -0.16074507515968153 -0.03880923470932488]\n (oklab->rgb [0.40 0.50 0.60]) := [1.1788092697656853 -0.6549919000430852 -0.42162843334771566]\n (oklab->rgb [1 1 1])          := [3.2211899649043 -1.7851374303318226 -0.7451880544335563]\n )\n"]}