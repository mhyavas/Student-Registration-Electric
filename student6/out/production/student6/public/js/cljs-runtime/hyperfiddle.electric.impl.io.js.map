{"version":3,"sources":["hyperfiddle/electric/impl/io.cljc"],"mappings":"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","names":["cljs.core/PROTOCOL_SENTINEL","com.cognitect.transit.types/UUID","hyperfiddle.electric.impl.io/default-write-handler","cognitect.transit.write_handler","x","hyperfiddle.electric.impl.io/-last-unserializable-for-repl","js/console.log","cljs.core.pr_str","cljs.core/type","_","hyperfiddle.electric.impl.io/->cache","size","G__33158","arr33159","cljs.core/identity","cljs.core.object_array","hyperfiddle.electric.impl.io/cache-add","cache","k","v","i","cljs.core/count","cljs.core._EQ_","hyperfiddle.electric.impl.array-fields/get","arr33170","widx","p1__33164#","hyperfiddle.electric.impl.array-fields/getswap","cljs.core/mod","arr33172","hyperfiddle.electric.impl.io/cache-get","hyperfiddle.electric.impl.io/cache->map","ac","cljs.core/transient","cljs.core.assoc_BANG_","cljs.core/persistent!","hyperfiddle.electric.impl.io/!ex-cache","hyperfiddle.electric.impl.io/save-original-ex!","fi","id","hyperfiddle.electric.debug/ex-id","temp__5808__auto__","cause","cljs.core/ex-cause","js/hyperfiddle.electric.FailureInfo","hyperfiddle.electric.impl.io/get-original-ex","hyperfiddle.electric.impl.io/*write-handlers*","hyperfiddle.electric.impl.io/failure-writer","err","js/missionary.Cancelled","js/hyperfiddle.electric.Pending","js/hyperfiddle.electric.Remote","hyperfiddle.electric.debug/serializable","cljs.core/ex-data","cljs.core/ex-message","hyperfiddle.electric.impl.io/write-opts","cljs.core.merge","js/hyperfiddle.electric.Failure","hyperfiddle.electric.impl.io/*read-handlers*","hyperfiddle.electric.impl.io/failure-reader","cognitect.transit/read-handler","p__33204","vec__33205","seq__33206","cljs.core/seq","first__33207","cljs.core/first","cljs.core/next","tag","args","G__33208","cljs.core/Keyword","js/Error","vec__33209","cljs.core.nth","message","data","hyperfiddle.electric.debug.ex_info_STAR_","vec__33216","or__5045__auto__","hyperfiddle.electric.impl.io/read-opts","hyperfiddle.electric.impl.io/set-ints","cljs.core.partial","cljs.core/reduce-kv","r","n","offset","G__33224","hyperfiddle.electric.impl.io/encode-numbers","xs","required","G__33226","js/ArrayBuffer","js/DataView","hyperfiddle.electric.impl.io/decode-numbers","b","cljs.core/vec","js/hyperfiddle","js/hyperfiddle.electric","js/hyperfiddle.electric.impl","js/hyperfiddle.electric.impl.io","js/hyperfiddle.electric.impl.io.t_hyperfiddle$electric$impl$io33236","hyperfiddle.electric.impl.io/t_hyperfiddle$electric$impl$io33236","_33238","meta33237","this__5330__auto__","writer__5331__auto__","opt__5332__auto__","cljs.core/-write","hyperfiddle.electric.impl.io/->t_hyperfiddle$electric$impl$io33236","rf","l","G__33240","G__33241","!cache","cljs.core.atom","hyperfiddle.electric.impl.io/transit-writer","cljs.core.swap_BANG_","p__33253","map__33254","cljs.core/--destructure-map","cljs.core.get","write-handlers","writer","cljs.core.assoc","cognitect.transit.writer","hyperfiddle.electric.impl.io/encode","cognitect.transit/write","hyperfiddle.electric.impl.io/transit-reader","p__33255","map__33256","read-handlers","reader","cognitect.transit.reader","hyperfiddle.electric.impl.io/decode","s","cognitect.transit/read","hyperfiddle.electric.impl.io/decode-str","e33287","G__33288","js/console.debug","t","cljs.core.ex_info","hyperfiddle.electric.impl.io/chunk-size","hyperfiddle.electric.impl.io/message-reader","?read","cr33290-state","cr33290-place-3","cr33290-block-2","missionary.core/park","cr33290-exception","e33360","cr33290-place-22","cr33290-place-30","missionary.core/unpark","cr33290-place-31","cr33290-block-4","e33361","cr33290-place-29","cr33290-block-6","e33363","cr33290-place-2","cr33290-place-4","cr33290-place-37","cr33290-place-38","cr33290-place-39","cr33290-place-40","cr33290-place-41","cr33290-place-42","cr33290-block-1","e33367","cr33290-place-7","e33373","cr33290-place-8","cr33290-place-9","cr33290-place-28","cr33290-place-10","cr33290-place-35","cr33290-place-36","cr33290-block-10","e33375","cr33290-place-11","cr33290-place-12","cr33290-place-13","cljs.core/IVector","cr33290-place-14","e33383","cr33290-place-5","cr33290-place-6","cr33290-block-9","cr33290-block-3","e33396","cr33290-place-15","cr33290-place-16","cr33290-place-17","cr33290-place-18","cr33290-place-19","cr33290-place-20","cr33290-place-21","cr33290-place-23","cr33290-place-24","cr33290-place-25","cr33290-place-26","cr33290-place-27","cr33290-block-7","cr33290-block-5","e33399","cr33290-place-32","cr33290-place-33","cr33290-place-34","cr33290-block-8","e33417","cr33290-place-0","cr33290-place-1","e33422","cloroutine.impl/coroutine","G__33427","cr33290-block-0","missionary.core/sp-run","G__33425","fexpr__33424","G__33371","G__33372","fexpr__33370","cljs.core/conj!","G__33369","fexpr__33368","G__33382","fexpr__33381","G__33379","G__33380","fexpr__33378","G__33385","fexpr__33384","G__33402","fexpr__33401","G__33410","G__33411","G__33412","fexpr__33409","cljs.core/reduce","G__33414","fexpr__33413","G__33421","fexpr__33420","p1__33428#","hyperfiddle.electric.impl.io/message-writer","write","cr33429-state","cr33429-place-46","cr33429-place-47","cr33429-place-48","cr33429-block-8","cr33429-exception","e33569","cr33429-place-54","cr33429-block-14","e33578","cr33429-place-72","cr33429-place-73","cr33429-place-74","cr33429-place-75","cr33429-place-76","e33580","cr33429-place-61","cr33429-block-13","e33586","cr33429-place-55","cr33429-place-56","cr33429-place-57","cr33429-place-58","cr33429-place-59","cr33429-place-60","cr33429-block-10","e33588","cr33429-place-62","cr33429-place-63","cr33429-place-64","cr33429-place-65","cr33429-place-66","cr33429-place-67","cr33429-place-68","cr33429-place-69","cr33429-place-70","cr33429-place-71","cr33429-block-12","e33593","cr33429-place-9","e33614","cr33429-place-27","cr33429-place-26","cr33429-place-40","cr33429-place-41","cr33429-place-42","cr33429-place-43","cr33429-block-6","e33615","cr33429-place-0","cr33429-place-1","cr33429-place-2","cr33429-place-3","cr33429-place-4","cr33429-block-1","e33630","cr33429-place-20","cr33429-place-28","cr33429-place-29","cr33429-place-30","cr33429-block-5","e33639","cr33429-block-4","cr33429-place-49","cr33429-place-50","cr33429-place-51","cr33429-place-52","cr33429-place-53","cr33429-block-11","cr33429-block-9","e33644","cr33429-place-5","cr33429-place-10","cr33429-place-11","cr33429-place-12","cr33429-place-13","cr33429-place-14","cr33429-place-15","cr33429-place-16","cr33429-place-17","cr33429-place-18","cr33429-place-19","cr33429-place-21","cr33429-place-22","cr33429-place-23","cr33429-place-24","cr33429-place-25","cr33429-block-3","e33649","cr33429-place-31","cr33429-place-32","cr33429-place-33","cr33429-place-34","cr33429-place-35","cr33429-place-36","cljs.core/IMap","cr33429-place-37","cr33429-place-38","cr33429-place-39","e33661","cr33429-place-6","cr33429-place-7","cr33429-place-8","cr33429-block-7","cr33429-block-2","e33676","cr33429-place-44","cr33429-place-45","e33681","G__33686","cr33429-block-0","G__33635","fexpr__33634","G__33632","fexpr__33631","cljs.core/pop","G__33652","fexpr__33651","G__33654","fexpr__33653","G__33656","fexpr__33655","G__33659","G__33660","fexpr__33658","G__33622","fexpr__33621","G__33642","fexpr__33641","G__33665","G__33666","G__33667","fexpr__33664","cljs.core/ex-info","G__33571","fexpr__33570","cljs.core/peek","G__33648","fexpr__33647","G__33613","fexpr__33612","G__33608","fexpr__33607","G__33604","G__33605","G__33606","fexpr__33603","cljs.core/subvec","G__33583","G__33584","fexpr__33582","G__33592","fexpr__33591","G__33590","fexpr__33589","hyperfiddle.electric.impl.io/decoder","G__33690","cljs.core.conj","cljs.core.into","hyperfiddle.electric.impl.io/encoder","cljs.core.reduce","cljs.core.eduction","cljs.core.map","cljs.core.partition_all","G__33710","G__33712","G__33713","var_args","G__33719","hyperfiddle.electric.impl.io/foreach"],"sourcesContent":[";; Facilities for encoding/decoding of Electric protocol messages.\n;; * Data frames can be arbitrary clojure data or Electric failures. Serialization is done via transit json, the failure\n;; error is preserved if it's an instance of `hyperfiddle.electric.Pending` or `hyperfiddle.electric.Cancelled`, otherwise\n;; the error is logged and turned into an instance of `hyperfiddle.electric.Remote`.\n;; * Control frames are vectors of signed integers. Serialization is the concatenation of the binary representation of\n;; these numbers as fixed-length 32-bit, big endian.\n\n(ns ^:no-doc hyperfiddle.electric.impl.io\n  (:require [missionary.core :as m]\n            [cognitect.transit :as t]\n            #?(:clj [clojure.tools.logging :as log])\n            [hyperfiddle.electric.debug :as dbg]\n            [hyperfiddle.rcf :as rcf :refer [tests with tap %]]\n            #?(:cljs [com.cognitect.transit.types])\n            [hyperfiddle.electric.impl.array-fields :as a])\n  (:import (missionary Cancelled)\n           (hyperfiddle.electric Failure Pending Remote FailureInfo)\n           #?(:clj (java.nio ByteBuffer))\n           #?(:clj (java.io ByteArrayInputStream ByteArrayOutputStream))\n           #?(:clj (clojure.lang IReduceInit))))\n\n#?(:cljs (extend-type com.cognitect.transit.types/UUID IUUID)) ; https://github.com/hyperfiddle/hyperfiddle/issues/728\n\n(def default-write-handler ; Intercepts unserializable values, logs and return nil\n  (t/write-handler ; Adapted from `com.cognitect.transit.impl.WriteHandlers.NullWriteHandler`\n    (fn [x]\n      (def -last-unserializable-for-repl x)\n      (#?(:clj log/info, :cljs js/console.log) \"Unserializable reference transfer:\" (pr-str (type x)) (str x))\n      \"_\")\n    (fn [x] nil)\n    (fn [_] \"\")))\n\n(defn ->cache \"Builds a minimal, cljc map/bounded-queue cache.\n  One slot per key (map).\n  Reaching `size` pops oldest value (bounded-queue).\" [size]\n  (doto (object-array (inc (* size 2))) (a/set (* size 2) 0)))\n(defn cache-add [cache k v]\n  (when-not (loop [i 0]\n              (when (< i (dec (count cache)))\n                (if (= k (a/get cache i))\n                  (do (a/set cache (inc i) v) true)\n                  (recur (+ i 2)))))\n    (let [widx (a/getswap cache (dec (count cache)) #(mod (+ % 2) (dec (count cache))))]\n      (a/set cache widx k, (inc widx) v))))\n(defn cache-get [cache k]\n  (loop [i 0]\n    (when (< i (dec (count cache)))\n      (if (= k (a/get cache i))\n        (a/get cache (inc i))\n        (recur (+ i 2))))))\n(defn cache->map [cache]\n  (loop [i 0, ac (transient {})]\n    (if (< i (dec (count cache)))\n      (recur (+ i 2) (assoc! ac (a/get cache i) (a/get cache (inc i))))\n      (persistent! ac))))\n\n(tests \"keyed cache\"\n  (def !c (->cache 1))\n  (cache-add !c 1 2) (cache-get !c 1) := 2\n  (cache-add !c 1 3) (cache-get !c 1) := 3\n  (cache-add !c 2 4) (cache-get !c 2) := 4\n  (cache->map !c) := {2 4}\n\n  \"size 2\"\n  (def !c (->cache 2))\n  (cache-add !c 1 1)\n  (cache-add !c 2 2)\n  (cache-add !c 2 2)\n  (cache->map !c) := {1 1, 2 2})\n\n(def !ex-cache (->cache 16))\n(defn save-original-ex! [fi]\n  (let [id (dbg/ex-id fi)]\n    (when-some [cause (ex-cause fi)]\n      (when-not (instance? FailureInfo cause)\n        (cache-add !ex-cache id cause)))\n    id))\n(defn get-original-ex [id] (cache-get !ex-cache id))\n\n(def ^:dynamic *write-handlers* nil)\n\n(def failure-writer (t/write-handler\n                      (fn [_] \"failure\")\n                      (fn [x]\n                        (let [err (.-error ^Failure x)]\n                          (cond (instance? Cancelled err) [:cancelled]\n                                (instance? Pending err)   [:pending]\n                                (instance? Remote err)    [:remote (dbg/serializable (ex-data err))]\n                                :else                     [:exception (ex-message err) (dbg/serializable (ex-data err))\n                                                           (save-original-ex! err)])))))\n\n(defn write-opts []\n  {:handlers (merge *write-handlers*\n               {Failure failure-writer\n                :default default-write-handler}) ; cljs\n   :default-handler default-write-handler}) ; clj\n\n(def ^:dynamic *read-handlers* nil)\n\n(def failure-reader (t/read-handler\n                      (fn [[tag & args]]\n                        (case tag\n                          :exception (let [[message data id] args]\n                                       (Failure. (dbg/ex-info* message data id nil)))\n                          :remote    (let [[data] args]\n                                       (Failure. (dbg/ex-info* \"Remote error\" (or data {}))))\n                          :pending   (Failure. (Pending.))\n                          :cancelled (Failure. (Cancelled.))))))\n\n(defn read-opts [] {:handlers (merge *read-handlers* {\"failure\" failure-reader})})\n\n(def set-ints\n  (partial reduce-kv\n    (fn [r i n]\n      (let [offset (bit-shift-left i 2)]\n        #?(:clj  (.putInt ^ByteBuffer r offset n)\n           :cljs (doto r (.setInt32 offset n)))))))\n\n(defn encode-numbers\n  \"Encode a control frame to a binary segment.\"\n  [xs]\n  (let [required (bit-shift-left (count xs) 2)] ; size of bytebuffer is 4 \u00d7 (count xs), so shift by 2\n    #?(:clj (set-ints (ByteBuffer/allocate required) xs)\n       :cljs (doto (js/ArrayBuffer. required)\n               (-> (js/DataView.) (set-ints xs))))))\n\n(defn decode-numbers\n  \"Decode a control frame from a binary segment.\"\n  [b]\n  (vec\n    (reify\n      #?(:clj IReduceInit :cljs IReduce)\n      #?(:clj (reduce [_ rf r]\n                (let [l (.limit ^ByteBuffer b)]\n                  (loop [r r, i (int 0)]\n                    (if (< i l)\n                      (recur (rf r (.getInt ^ByteBuffer b i))\n                        (unchecked-add-int i 4)) r))))\n         :cljs (-reduce [_ rf r]\n                 (let [l (.-byteLength b)\n                       v (js/DataView. b)]\n                   (loop [r r, i 0]\n                     (if (< i l)\n                       (recur (rf r (.getInt32 v i))\n                         (+ i 4)) r))))))))\n\n\n;; #?(:cljs (def transit-writer (t/writer :json (write-opts))))\n#?(:cljs (let [!cache (atom {:write-handlers *write-handlers*, :writer nil})]\n           (defn transit-writer []\n             (:writer (swap! !cache (fn [{:keys [write-handlers writer] :as cache}]\n                                      (if (= write-handlers *write-handlers*)\n                                        (if writer\n                                          cache\n                                          (assoc cache :writer (t/writer :json (write-opts))))\n                                        {:write-handlers *write-handlers*\n                                         :writer         (t/writer :json (write-opts))})))))))\n\n(defn encode\n  \"Encode a data frame to transit json\"\n  [x]\n  #?(:clj (let [out (ByteArrayOutputStream.)]\n            (t/write (t/writer out :json (write-opts)) x)\n            (.toString out))\n     :cljs (t/write (transit-writer) x)))\n\n;; #?(:cljs (def transit-reader (t/reader :json (read-opts))))\n#?(:cljs (let [!cache (atom {:read-handlers *read-handlers*, :reader nil})]\n           (defn transit-reader []\n             (:reader (swap! !cache (fn [{:keys [read-handlers reader] :as cache}]\n                                      (if (= read-handlers *read-handlers*)\n                                        (if reader\n                                          cache\n                                          (assoc cache :reader (t/reader :json (read-opts))))\n                                        {:read-handlers *read-handlers*\n                                         :reader        (t/reader :json (read-opts))})))))))\n\n\n(defn decode\n  \"Decode a data frame from transit json\"\n  [^String s]\n  #?(:clj (t/read (t/reader (ByteArrayInputStream. (.getBytes s \"UTF-8\")) :json (read-opts)))\n     :cljs (t/read (transit-reader) s)))\n\n(defn decode-str [x]\n  (try (doto (decode x) (->> (#?(:clj log/trace, :cljs js/console.debug) \"\ud83d\udd3d\")))\n    (catch #?(:clj Throwable :cljs :default) t\n      (throw (ex-info \"Failed to decode\" {:value x} t)))))\n\n(tests \"FailureInfo\"\n  (def cause (ex-info \"boom\" {}))\n  (def ex (dbg/ex-info* \"x\" {} cause))\n  (def sent (-> ex Failure. encode decode .-error))\n  \"keeps the ID across the wire\"\n  (dbg/ex-id ex) := (dbg/ex-id sent)\n  \"can restore cause\"\n  (get-original-ex (dbg/ex-id sent)) := cause\n  nil)\n\n; Jetty rejects websocket payloads larger than 65536 bytes by default\n; We\u2019ll chop messages if needed\n(def chunk-size (bit-shift-right 65536 2))\n\n(defn ^:deprecated message-reader [?read]\n  \"Returns a discrete flow of read Electric messages from provided task, emitting individual frames.\"\n  (m/sp\n    (loop [data (transient [])]\n      (let [x (m/? ?read)]\n        (if (string? x)\n          (recur (conj! data (decode-str x)))\n          (persistent!\n            (conj! data\n              (loop [x       x\n                     control (transient [])]\n                (let [xs      (decode-numbers x)\n                      control (reduce conj! control xs)]\n                  (if (< (count xs) chunk-size) ; final frame\n                    (persistent! control)\n                    (recur (m/? ?read) control)))))))))))\n\n\n(defn ^:deprecated message-writer\n  \"Returns a function taking an Electric message and returning a task writing it as individual frames using provided\n   function. Might cut a message into chunks if its size would exceed the server payload limit.\n   An empty message (0b) is written to notify the end of frame.\"\n  [write]\n  #(m/sp\n     (loop [xs (seq (pop %))]\n       (if-some [[x & xs] xs]\n         (do (#?(:clj log/trace, :cljs js/console.debug) \"\ud83d\udd3c\" x)\n           (m/? (write\n                  (try (encode x)\n                    (catch #?(:clj Throwable :cljs :default) t\n                      (throw (ex-info \"Failed to encode\" {:value x} t))))))\n           (recur xs))\n         (loop [xs (peek %)]\n           (if (>= (count xs) chunk-size)\n             (do (m/? (write (encode-numbers (subvec xs 0 chunk-size))))\n               (recur (subvec xs chunk-size)))\n             (m/? (write (encode-numbers xs)))))))))\n\n(defn ^:deprecated decoder\n  \"A transducer partitioning a sequence of network messages into Electric events.\"\n  [rf]\n  (let [data (doto (object-array 2)\n               (aset 0 []) (aset 1 []))]\n    (fn\n      ([] (rf))\n      ([r]\n       (assert (= [] (aget data 0) (aget data 1)))\n       (rf r))\n      ([r x]\n       (if (string? x)\n         (do (assert (= [] (aget data 1)))\n             (aset data 0 (conj (aget data 0) (decode-str x))) r)\n         (let [xs (decode-numbers x)]\n           (aset data 1 (into (aget data 1) xs))\n           (if (< (count xs) chunk-size)                  ; final frame\n             (let [x (conj (aget data 0) (aget data 1))]\n               (aset data 0 [])\n               (aset data 1 [])\n               (rf r x)) r)))))))\n\n(defn ^:deprecated encoder\n  \"A transducer expanding Electric events to a sequence of network messages.\"\n  [rf]\n  (fn\n    ([] (rf))\n    ([r] (rf r))\n    ([r x]\n     (let [r (reduce rf r (eduction (map encode) (pop x)))\n           r (reduce rf r (eduction (partition-all chunk-size) (map encode-numbers) (peek x)))]\n       (case (mod (count (peek x)) chunk-size)\n         0 (rf r (encode-numbers [])) r)))))\n\n(defn foreach\n  ([r] r)\n  ([r x] (r x) r))\n"]}