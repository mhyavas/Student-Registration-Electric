{"version":3,"sources":["demo/demo_4_chat.cljc"],"mappings":";AASA","names":[],"sourcesContent":["(ns demo.demo-4-chat\r\n  (:import [hyperfiddle.electric Pending])\r\n  (:require [contrib.data :refer [pad]]\r\n            [contrib.str :refer [empty->nil]]\r\n            [hyperfiddle.electric :as e]\r\n            [hyperfiddle.electric-dom2 :as dom]))\r\n\r\n#?(:clj (defonce !state (atom (list))))\r\n\r\n(e/defn App []\r\n  (e/client\r\n    (try\r\n      (dom/h1 (dom/text \"Multiplayer chat app in 30 LOC\"))\r\n      (dom/p (dom/text \"try two tabs!\"))\r\n      (dom/ul (dom/style {:padding-left \"1.5em\"})\r\n        (e/server\r\n          (e/for-by identity [msg (reverse (pad 10 nil (e/watch !state)))]\r\n            (e/client\r\n              (dom/li (dom/style {:visibility (if (nil? msg) \"hidden\" \"visible\")})\r\n                (dom/text msg))))))\r\n\r\n      (dom/input\r\n        (dom/props {:placeholder \"Type a message\"})\r\n        (dom/on \"keydown\" (e/fn [e]\r\n                            (when (= \"Enter\" (.-key e))\r\n                              (when-some [v (empty->nil (-> e .-target .-value))]\r\n                                #_(dom/style {:background-color \"yellow\"})\r\n                                (e/server (swap! !state #(cons v (take 9 %))))\r\n                                (set! (.-value dom/node) \"\"))))))\r\n      (catch Pending e\r\n        (dom/style {:background-color \"yellow\"})))))\r\n\r\n; A chat app. Open it in two tabs. When you type a message, both tabs update.\r\n; This works because both tabs share a single JVM which means they subscribe to the same atom."]}